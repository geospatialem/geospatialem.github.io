"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2480],{82480:(pe,V,D)=>{D.r(V),D.d(V,{registerFunctions:()=>ce});var R=D(37780),w=D(6729),S=D(42275),H=D(90512),O=D(85171),te=D(7652),ne=D(98362),a=D(47562),E=D(52724),X=D(53997),re=D(95896),ae=D(79429),se=D(62074),ie=D(16776),le=D(57366),W=D(77132),z=D(83947),j=D(50818),A=D(10699),_=D(10410),Z=D(15382),v=D(36255);function U(t,s,p){const y=t.getVariables();if(y.length>0){const F=[];for(let e=0;e<y.length;e++)F.push(s.evaluateIdentifier(p,{name:y[e]}));return(0,A.$6)(F).then(e=>{const i={};for(let n=0;n<y.length;n++)i[y[n]]=e[n];return t.parameters=i,t})}return(0,A.DB)(t)}function c(t,s,p=null){for(const y in t)if(y.toLowerCase()===s.toLowerCase())return t[y];return p}function J(t){if(null===t)return null;const s={type:c(t,"type",""),name:c(t,"name","")};if("range"===s.type)s.range=c(t,"range",[]);else{s.codedValues=[];for(const p of c(t,"codedValues",[]))s.codedValues.push({name:c(p,"name",""),code:c(p,"code",null)})}return s}function K(t){if(null===t)return null;const s={},p=c(t,"wkt",null);null!==p&&(s.wkt=p);const y=c(t,"wkid",null);return null!==y&&(s.wkid=y),s}function k(t){if(null===t)return null;const s={hasZ:c(t,"hasz",!1),hasM:c(t,"hasm",!1)},p=c(t,"spatialreference",null);p&&(s.spatialReference=K(p));const y=c(t,"x",null);if(null!==y)return s.x=y,s.y=c(t,"y",null),s;const F=c(t,"rings",null);if(null!==F)return s.rings=F,s;const e=c(t,"paths",null);if(null!==e)return s.paths=e,s;const i=c(t,"points",null);if(null!==i)return s.points=i,s;for(const n of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const u=c(t,n,null);null!==u&&(s[n]=u)}return s}function ce(t){"async"===t.mode&&(t.functions.getuser=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{(0,a.p)(e,1,2);let i=(0,a.E)(e[1],""),n=!0===i;if(i=!0===i||!1===i?"":(0,a.d)(i),e[0]instanceof R.Z){let m=null;return s.services&&s.services.portal&&(m=s.services.portal),m=(0,O.getPortal)(e[0],m),(0,O.lookupUser)(m,i,n).then(o=>{if(o){const l=JSON.parse(JSON.stringify(o));for(const r of["lastLogin","created","modified"])null!=l[r]&&(l[r]=new Date(l[r]));return w.Z.convertObjectToArcadeDictionary(l)}return null})}let u=null;if((0,a.o)(e[0])&&(u=e[0]),u)return n=!1,i?null:u.load().then(()=>u.getOwningSystemUrl()).then(m=>{if(!m)return i?null:u.getIdentityUser().then(l=>l?w.Z.convertObjectToArcadeDictionary({username:l}):null);let o=null;return s.services&&s.services.portal&&(o=s.services.portal),o=(0,O.getPortal)(new R.Z(m),o),(0,O.lookupUser)(o,i,n).then(l=>{if(l){const r=JSON.parse(JSON.stringify(l));for(const f of["lastLogin","created","modified"])null!=r[f]&&(r[f]=new Date(r[f]));return w.Z.convertObjectToArcadeDictionary(r)}return null})});throw new Error("Invalid Parameter")})},t.signatures.push({name:"getuser",min:"1",max:"2"}),t.functions.featuresetbyid=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{if((0,a.p)(e,2,4),e[0]instanceof H.Z){const i=(0,a.d)(e[1]);let n=(0,a.E)(e[2],null);const u=(0,a.y)((0,a.E)(e[3],!0));if(null===n&&(n=["*"]),!1===(0,a.a)(n))throw new Error("Invalid Parameter");return e[0].featureSetById(i,u,n)}throw new Error("Invalid Parameter")})},t.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),t.functions.getfeatureset=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{if((0,a.p)(e,1,2),e[0]instanceof S.Z){let i=(0,a.E)(e[1],"datasource");return null===i&&(i="datasource"),i=(0,a.d)(i).toLowerCase(),(0,O.convertToFeatureSet)(e[0]._layer,i,s.lrucache,s.interceptor,s.spatialReference)}throw new Error("Invalid Parameter")})},t.signatures.push({name:"getfeatureset",min:"1",max:"2"}),t.functions.featuresetbyportalitem=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{if((0,a.p)(e,2,5),null===e[0])throw new Error("Portal is required");if(e[0]instanceof R.Z){const o=(0,a.d)(e[1]),l=(0,a.d)(e[2]);let r=(0,a.E)(e[3],null);const f=(0,a.y)((0,a.E)(e[4],!0));if(null===r&&(r=["*"]),!1===(0,a.a)(r))throw new Error("Invalid Parameter");let d=null;return s.services&&s.services.portal&&(d=s.services.portal),d=(0,O.getPortal)(e[0],d),(0,O.constructFeatureSetFromPortalItem)(o,l,s.spatialReference,r,f,d,s.lrucache,s.interceptor)}if(!1===(0,a.f)(e[0]))throw new Error("Portal is required");const i=(0,a.d)(e[0]),n=(0,a.d)(e[1]);let u=(0,a.E)(e[2],null);const m=(0,a.y)((0,a.E)(e[3],!0));if(null===u&&(u=["*"]),!1===(0,a.a)(u))throw new Error("Invalid Parameter");if(s.services&&s.services.portal)return(0,O.constructFeatureSetFromPortalItem)(i,n,s.spatialReference,u,m,s.services.portal,s.lrucache,s.interceptor);throw new Error("Portal is required")})},t.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),t.functions.featuresetbyname=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{if((0,a.p)(e,2,4),e[0]instanceof H.Z){const i=(0,a.d)(e[1]);let n=(0,a.E)(e[2],null);const u=(0,a.y)((0,a.E)(e[3],!0));if(null===n&&(n=["*"]),!1===(0,a.a)(n))throw new Error("Invalid Parameter");return e[0].featureSetByName(i,u,n)}throw new Error("Invalid Parameter")})},t.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),t.functions.featureset=function(s,p){return t.standardFunction(s,p,(y,F,e)=>{(0,a.p)(e,1,1);let i=e[0];const n={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,a.f)(i))i=JSON.parse(i),void 0!==i.layerDefinition?(n.layerDefinition=i.layerDefinition,n.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(n.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(n.featureSet.features=i.features,n.featureSet.geometryType=i.geometryType,n.layerDefinition.geometryType=n.featureSet.geometryType,n.layerDefinition.objectIdField=i.objectIdFieldName,n.layerDefinition.typeIdField=i.typeIdFieldName,n.layerDefinition.globalIdField=i.globalIdFieldName,n.layerDefinition.fields=i.fields,i.spatialReference&&(n.layerDefinition.spatialReference=i.spatialReference));else{if(!(e[0]instanceof w.Z))throw new Error("Invalid Parameter");{i=JSON.parse(e[0].castToText());const u=c(i,"layerdefinition");if(null!==u){n.layerDefinition.geometryType=c(u,"geometrytype",""),n.featureSet.geometryType=n.layerDefinition.geometryType,n.layerDefinition.globalIdField=c(u,"globalidfield",""),n.layerDefinition.objectIdField=c(u,"objectidfield",""),n.layerDefinition.typeIdField=c(u,"typeidfield","");const m=c(u,"spatialreference",null);m&&(n.layerDefinition.spatialReference=K(m));for(const l of c(u,"fields",[])){const r={name:c(l,"name",""),alias:c(l,"alias",""),type:c(l,"type",""),nullable:c(l,"nullable",!0),editable:c(l,"editable",!0),length:c(l,"length",null),domain:J(c(l,"domain"))};n.layerDefinition.fields.push(r)}const o=c(i,"featureset",null);if(o){const l={};for(const r of n.layerDefinition.fields)l[r.name.toLowerCase()]=r.name;for(const r of c(o,"features",[])){const f={},d=c(r,"attributes",{});for(const I in d)f[l[I.toLowerCase()]]=d[I];n.featureSet.features.push({attributes:f,geometry:k(c(r,"geometry",null))})}}}else{n.layerDefinition.geometryType=c(i,"geometrytype",""),n.featureSet.geometryType=n.layerDefinition.geometryType,n.layerDefinition.objectIdField=c(i,"objectidfieldname",""),n.layerDefinition.typeIdField=c(i,"typeidfieldname","");const m=c(i,"spatialreference",null);m&&(n.layerDefinition.spatialReference=K(m));for(const l of c(i,"fields",[])){const r={name:c(l,"name",""),alias:c(l,"alias",""),type:c(l,"type",""),nullable:c(l,"nullable",!0),editable:c(l,"editable",!0),length:c(l,"length",null),domain:J(c(l,"domain"))};n.layerDefinition.fields.push(r)}const o={};for(const l of n.layerDefinition.fields)o[l.name.toLowerCase()]=l.name;for(const l of c(i,"features",[])){const r={},f=c(l,"attributes",{});for(const d in f)r[o[d.toLowerCase()]]=f[d];n.featureSet.features.push({attributes:r,geometry:k(c(l,"geometry",null))})}}}}if(!1===function fe(t){return!!t.layerDefinition&&!!t.featureSet&&!1!==function ue(t,s){for(const p of s)if(p===t)return!0;return!1}(t.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==t.layerDefinition.objectIdField&&""!==t.layerDefinition.objectIdField&&!1!==(0,a.a)(t.layerDefinition.fields)&&!1!==(0,a.a)(t.featureSet.features)}(n))throw new Error("Invalid Parameter");return ie.Z.create(n,s.spatialReference)})},t.signatures.push({name:"featureset",min:"1",max:"1"}),t.functions.filter=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{if((0,a.p)(e,2,2),(0,a.a)(e[0])||(0,a.b)(e[0])){const i=[];let n=e[0];n instanceof ne.Z&&(n=n.toArray());let u=null;if(e[1]instanceof te.Z)u=t.arcadeCustomFunctionHandler(e[1]);else if(e[1]instanceof a.N)u=(...m)=>e[1].fn(s,{preparsed:!0,arguments:m});else{if(!(e[1]instanceof a.S))throw new Error("Invalid Parameter");u=(...m)=>{if(m.length!==e[1].paramCount)throw new Error("Invalid parameters");return e[1].fn(...m)}}return n.reduce((m,o,l)=>m.then(r=>{l>0&&!0===r&&i.push(n[l-1]);const f=u(o);return(0,A.y8)(f)?f:(0,A.DB)(f)}),Promise.resolve(!1)).then(m=>(!0===m&&n.length>0&&i.push(n[n.length-1]),i))}return(0,a.o)(e[0])?e[0].load().then(i=>{const n=_.WhereClause.create(e[1],i.getFieldsIndex()),u=n.getVariables();if(u.length>0){const m=[];for(let o=0;o<u.length;o++)m.push(t.evaluateIdentifier(s,{name:u[o]}));return(0,A.$6)(m).then(o=>{const l={};for(let r=0;r<u.length;r++)l[u[r]]=o[r];return n.parameters=l,new X.Z({parentfeatureset:e[0],whereclause:n})})}return(0,A.DB)(new X.Z({parentfeatureset:e[0],whereclause:n}))}):t.failDefferred("Filter cannot accept this parameter type")})},t.signatures.push({name:"filter",min:"2",max:"2"}),t.functions.orderby=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{if((0,a.p)(e,2,2),(0,a.o)(e[0])){const i=new le.Z(e[1]);return(0,A.DB)(new re.Z({parentfeatureset:e[0],orderbyclause:i}))}return t.failDefferred("Order cannot accept this parameter type")})},t.signatures.push({name:"orderby",min:"2",max:"2"}),t.functions.top=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>((0,a.p)(e,2,2),(0,a.o)(e[0])?(0,A.DB)(new ae.Z({parentfeatureset:e[0],topnum:e[1]})):(0,a.a)(e[0])?(0,a.t)(e[1])>=e[0].length?e[0].slice(0):e[0].slice(0,(0,a.t)(e[1])):(0,a.b)(e[0])?(0,a.t)(e[1])>=e[0].length()?e[0].slice(0):e[0].slice(0,(0,a.t)(e[1])):t.failDefferred("Top cannot accept this parameter type")))},t.signatures.push({name:"top",min:"2",max:"2"}),t.functions.first=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>((0,a.p)(e,1,1),(0,a.o)(e[0])?e[0].first(y.abortSignal).then(i=>{if(null!==i){const n=S.Z.createFromGraphicLikeObject(i.geometry,i.attributes,e[0]);n._underlyingGraphic=i,i=n}return i}):(0,a.a)(e[0])?(0,A.DB)(0===e[0].length?null:e[0][0]):(0,a.b)(e[0])?0===e[0].length()?(0,A.DB)(null):(0,A.DB)(e[0].get(0)):null))},t.signatures.push({name:"first",min:"1",max:"1"}),t.functions.attachments=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{(0,a.p)(e,1,2);const i={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(e.length>1)if(e[1]instanceof w.Z){if(e[1].hasField("minsize")&&(i.minsize=(0,a.t)(e[1].field("minsize"))),e[1].hasField("metadata")&&(i.returnMetadata=(0,a.y)(e[1].field("metadata"))),e[1].hasField("maxsize")&&(i.maxsize=(0,a.t)(e[1].field("maxsize"))),e[1].hasField("types")){const n=(0,a.V)(e[1].field("types"),!1);n.length>0&&(i.types=n)}}else if(null!==e[1])throw new Error("Invalid Parameter");if(e[0]instanceof S.Z){let n=e[0]._layer;return n instanceof Z.default&&(n=(0,O.constructFeatureSet)(n,s.spatialReference,["*"],!0,s.lrucache,s.interceptor)),null===n||!1===(0,a.o)(n)?[]:n.load().then(()=>n.queryAttachments(e[0].field(n.objectIdField),i.minsize,i.maxsize,i.types,i.returnMetadata))}if(null===e[0])return[];throw new Error("Invalid Parameter")})},t.signatures.push({name:"attachments",min:"1",max:"2"}),t.functions.featuresetbyrelationshipname=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{(0,a.p)(e,2,4);const i=e[0],n=(0,a.d)(e[1]);let u=(0,a.E)(e[2],null);const m=(0,a.y)((0,a.E)(e[3],!0));if(null===u&&(u=["*"]),!1===(0,a.a)(u))throw new Error("Invalid Parameter");if(null===e[0])return null;if(!(e[0]instanceof S.Z))throw new Error("Invalid Parameter");let o=i._layer;return o instanceof Z.default&&(o=(0,O.constructFeatureSet)(o,s.spatialReference,["*"],!0,s.lrucache,s.interceptor)),null===o||!1===(0,a.o)(o)?null:o.load().then(l=>{const r=l.relationshipMetaData().filter(d=>d.name===n);if(0===r.length)return null;if(null!=r[0].relationshipTableId&&r[0].relationshipTableId>-1)return(0,O.constructFeatureSetFromRelationship)(l,r[0],i.field(l.objectIdField),l.spatialReference,u,m,s.lrucache,s.interceptor);let f=l.serviceUrl();return f?(f="/"===f.charAt(f.length-1)?f+r[0].relatedTableId.toString():f+"/"+r[0].relatedTableId.toString(),(0,O.constructFeatureSetFromUrl)(f,l.spatialReference,u,m,s.lrucache,s.interceptor).then(d=>d.load().then(()=>d.relationshipMetaData()).then(I=>{if(I=I.filter(C=>C.id===r[0].id),!1===i.hasField(r[0].keyField)||null===i.field(r[0].keyField))return l.getFeatureByObjectId(i.field(l.objectIdField),[r[0].keyField]).then(C=>{if(C){const M=_.WhereClause.create(I[0].keyField+"= @id",d.getFieldsIndex());return M.parameters={id:C.attributes[r[0].keyField]},d.filter(M)}return new se.Z({parentfeatureset:d})});const P=_.WhereClause.create(I[0].keyField+"= @id",d.getFieldsIndex());return P.parameters={id:i.field(r[0].keyField)},d.filter(P)}))):null})})},t.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),t.functions.featuresetbyassociation=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>{(0,a.p)(e,2,3);const i=e[0],n=(0,a.d)((0,a.E)(e[1],"")).toLowerCase(),u=(0,a.f)(e[2])?(0,a.d)(e[2]):null;if(null===e[0])return null;if(!(e[0]instanceof S.Z))throw new Error("Invalid Parameter");let m=i._layer;return m instanceof Z.default&&(m=(0,O.constructFeatureSet)(m,s.spatialReference,["*"],!0,s.lrucache,s.interceptor)),null===m||!1===(0,a.o)(m)?null:m.load().then(()=>{const o=m.serviceUrl();return(0,O.constructAssociationMetaDataFeatureSetFromUrl)(o,s.spatialReference)}).then(o=>{let l=null,r=null,f=!1;if(null!==u&&""!==u&&void 0!==u){for(const g of o.terminals)g.terminalName===u&&(r=g.terminalId);null===r&&(f=!0)}const d=o.associations.getFieldsIndex(),I=d.get("TOGLOBALID").name,P=d.get("FROMGLOBALID").name,C=d.get("TOTERMINALID").name,M=d.get("FROMTERMINALID").name,b=d.get("FROMNETWORKSOURCEID").name,$=d.get("TONETWORKSOURCEID").name,L=d.get("ASSOCIATIONTYPE").name,de=d.get("ISCONTENTVISIBLE").name,me=d.get("OBJECTID").name;for(const g of m.fields)if("global-id"===g.type){l=i.field(g.name);break}let x=null,Q=new E.yN(new v.Z({name:"percentalong",alias:"percentalong",type:"double"}),_.WhereClause.create("0",o.associations.getFieldsIndex())),Y=new E.yN(new v.Z({name:"side",alias:"side",type:"string"}),_.WhereClause.create("''",o.associations.getFieldsIndex()));const N="globalid",B="globalId",q={};for(const g in o.lkp)q[g]=o.lkp[g].sourceId;const T=new E.TO(new v.Z({name:"classname",alias:"classname",type:"string"}),null,q);let h="";switch(n){case"midspan":{h=`((${I}='${l}') OR ( ${P}='${l}')) AND (${L} IN (5))`,T.codefield=_.WhereClause.create(`CASE WHEN (${I}='${l}') THEN ${b} ELSE ${$} END`,o.associations.getFieldsIndex());const g=(0,W.JW)(E.Xx.findField(o.associations.fields,P));g.name=N,g.alias=N,x=new E.yN(g,_.WhereClause.create(`CASE WHEN (${P}='${l}') THEN ${I} ELSE ${P} END`,o.associations.getFieldsIndex())),Q=o.unVersion>=4?new E.$X(E.Xx.findField(o.associations.fields,d.get("PERCENTALONG").name)):new E.yN(new v.Z({name:"percentalong",alias:"percentalong",type:"double"}),_.WhereClause.create("0",o.associations.getFieldsIndex()));break}case"junctionedge":{h=`((${I}='${l}') OR ( ${P}='${l}')) AND (${L} IN (4,6))`,T.codefield=_.WhereClause.create(`CASE WHEN (${I}='${l}') THEN ${b} ELSE ${$} END`,o.associations.getFieldsIndex());const g=(0,W.JW)(E.Xx.findField(o.associations.fields,P));g.name=N,g.alias=N,x=new E.yN(g,_.WhereClause.create(`CASE WHEN (${P}='${l}') THEN ${I} ELSE ${P} END`,o.associations.getFieldsIndex())),Y=new E.yN(new v.Z({name:"side",alias:"side",type:"string"}),_.WhereClause.create(`CASE WHEN (${L}=4) THEN 'from' ELSE 'to' END`,o.associations.getFieldsIndex()));break}case"connected":{let g=`${I}='@T'`,ee=`${P}='@T'`;null!==r&&(g+=` AND ${C}=@A`,ee+=` AND ${M}=@A`),h="(("+g+") OR ("+ee+"))",h=(0,a.P)(h,"@T",l),g=(0,a.P)(g,"@T",l),null!==r&&(g=(0,a.P)(g,"@A",r.toString()),h=(0,a.P)(h,"@A",r.toString())),T.codefield=_.WhereClause.create("CASE WHEN "+g+` THEN ${b} ELSE ${$} END`,o.associations.getFieldsIndex());const G=(0,W.JW)(E.Xx.findField(o.associations.fields,P));G.name=N,G.alias=N,x=new E.yN(G,_.WhereClause.create("CASE WHEN "+g+` THEN ${P} ELSE ${I} END`,o.associations.getFieldsIndex()));break}case"container":h=`${I}='${l}' AND ${L} = 2`,null!==r&&(h+=` AND ${C} = `+r.toString()),T.codefield=b,h="( "+h+" )",x=new E.QP(E.Xx.findField(o.associations.fields,P),N,N);case"content":h=`(${P}='${l}' AND ${L} = 2)`,null!==r&&(h+=` AND ${M} = `+r.toString()),T.codefield=$,h="( "+h+" )",x=new E.QP(E.Xx.findField(o.associations.fields,I),N,N);break;case"structure":h=`(${I}='${l}' AND ${L} = 3)`,null!==r&&(h+=` AND ${C} = `+r.toString()),T.codefield=b,h="( "+h+" )",x=new E.QP(E.Xx.findField(o.associations.fields,P),N,B);break;case"attached":h=`(${P}='${l}' AND ${L} = 3)`,null!==r&&(h+=` AND ${M} = `+r.toString()),T.codefield=$,h="( "+h+" )",x=new E.QP(E.Xx.findField(o.associations.fields,I),N,B);break;default:throw new Error("Invalid Parameter")}return f&&(h="1 <> 1"),new E.Xx({parentfeatureset:o.associations,adaptedFields:[new E.$X(E.Xx.findField(o.associations.fields,me)),new E.$X(E.Xx.findField(o.associations.fields,de)),x,Y,T,Q],extraFilter:h?_.WhereClause.create(h,o.associations.getFieldsIndex()):null})})})},t.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),t.functions.groupby=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>((0,a.p)(e,3,3),(0,a.o)(e[0])?e[0].load().then(i=>{const n=[],u=[];let m=!1,o=[];if((0,a.f)(e[1]))o.push(e[1]);else if(e[1]instanceof w.Z)o.push(e[1]);else if((0,a.a)(e[1]))o=e[1];else{if(!(0,a.b)(e[1]))return t.failDefferred("Illegal Value: GroupBy");o=e[1].toArray()}for(const r of o)if((0,a.f)(r)){const f=_.WhereClause.create((0,a.d)(r),i.getFieldsIndex()),d=!0===(0,z.y5)(f)?(0,a.d)(r):"%%%%FIELDNAME";n.push({name:d,expression:f}),"%%%%FIELDNAME"===d&&(m=!0)}else{if(!(r instanceof w.Z))return t.failDefferred("Illegal Value: GroupBy");{const f=r.hasField("name")?r.field("name"):"%%%%FIELDNAME",d=r.hasField("expression")?r.field("expression"):"";if("%%%%FIELDNAME"===f&&(m=!0),!f)return t.failDefferred("Illegal Value: GroupBy");n.push({name:f,expression:_.WhereClause.create(d||f,i.getFieldsIndex())})}}if(o=[],(0,a.f)(e[2]))o.push(e[2]);else if((0,a.a)(e[2]))o=e[2];else if((0,a.b)(e[2]))o=e[2].toArray();else{if(!(e[2]instanceof w.Z))return t.failDefferred("Illegal Value: GroupBy");o.push(e[2])}for(const r of o){if(!(r instanceof w.Z))return t.failDefferred("Illegal Value: GroupBy");{const f=r.hasField("name")?r.field("name"):"",d=r.hasField("statistic")?r.field("statistic"):"",I=r.hasField("expression")?r.field("expression"):"";if(!f||!d||!I)return t.failDefferred("Illegal Value: GroupBy");u.push({name:f,statistic:d.toLowerCase(),expression:_.WhereClause.create(I,i.getFieldsIndex())})}}if(m){const r={};for(const d of i.fields)r[d.name.toLowerCase()]=1;for(const d of n)"%%%%FIELDNAME"!==d.name&&(r[d.name.toLowerCase()]=1);for(const d of u)"%%%%FIELDNAME"!==d.name&&(r[d.name.toLowerCase()]=1);let f=0;for(const d of n)if("%%%%FIELDNAME"===d.name){for(;1===r["field_"+f.toString()];)f++;r["field_"+f.toString()]=1,d.name="FIELD_"+f.toString()}}const l=[];for(const r of n)l.push(U(r.expression,t,s));for(const r of u)l.push(U(r.expression,t,s));return l.length>0?(0,A.$6)(l).then(()=>(0,A.DB)(e[0].groupby(n,u))):(0,A.DB)(e[0].groupby(n,u))}):t.failDefferred("Illegal Value: GroupBy")))},t.signatures.push({name:"groupby",min:"3",max:"3"}),t.functions.distinct=function(s,p){return t.standardFunctionAsync(s,p,(y,F,e)=>(0,a.o)(e[0])?((0,a.p)(e,2,2),e[0].load().then(i=>{const n=[];let u=[];if((0,a.f)(e[1]))u.push(e[1]);else if(e[1]instanceof w.Z)u.push(e[1]);else if((0,a.a)(e[1]))u=e[1];else{if(!(0,a.b)(e[1]))return t.failDefferred("Illegal Value: GroupBy");u=e[1].toArray()}let m=!1;for(const l of u)if((0,a.f)(l)){const r=_.WhereClause.create((0,a.d)(l),i.getFieldsIndex()),f=!0===(0,z.y5)(r)?(0,a.d)(l):"%%%%FIELDNAME";n.push({name:f,expression:r}),"%%%%FIELDNAME"===f&&(m=!0)}else{if(!(l instanceof w.Z))return t.failDefferred("Illegal Value: GroupBy");{const r=l.hasField("name")?l.field("name"):"%%%%FIELDNAME",f=l.hasField("expression")?l.field("expression"):"";if("%%%%FIELDNAME"===r&&(m=!0),!r)return t.failDefferred("Illegal Value: GroupBy");n.push({name:r,expression:_.WhereClause.create(f||r,i.getFieldsIndex())})}}if(m){const l={};for(const f of i.fields)l[f.name.toLowerCase()]=1;for(const f of n)"%%%%FIELDNAME"!==f.name&&(l[f.name.toLowerCase()]=1);let r=0;for(const f of n)if("%%%%FIELDNAME"===f.name){for(;1===l["field_"+r.toString()];)r++;l["field_"+r.toString()]=1,f.name="FIELD_"+r.toString()}}const o=[];for(const l of n)o.push(U(l.expression,t,s));return o.length>0?(0,A.$6)(o).then(()=>(0,A.DB)(e[0].groupby(n,[]))):(0,A.DB)(e[0].groupby(n,[]))})):function oe(t,s,p,y){if(1===y.length){if((0,a.a)(y[0]))return(0,j.t)(t,y[0],-1);if((0,a.b)(y[0]))return(0,j.t)(t,y[0].toArray(),-1)}return(0,j.t)(t,y,-1)}("distinct",0,0,e))})}}}]);