"use strict";var it=Object.defineProperty,$=Object.getOwnPropertySymbols,nt=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,q=(w,L,g)=>L in w?it(w,L,{enumerable:!0,configurable:!0,writable:!0,value:g}):w[L]=g,tt=(w,L)=>{for(var g in L||(L={}))nt.call(L,g)&&q(w,g,L[g]);if($)for(var g of $(L))ot.call(L,g)&&q(w,g,L[g]);return w};(self.webpackChunksite=self.webpackChunksite||[]).push([[1572],{15994:(w,L,g)=>{g.d(L,{N:()=>C});const C={convertToGEGeometry:function N(b,M){return null==M?null:b.convertJSONToGeometry(M)},exportPoint:function f(b,M,z){const D=new p(b.getPointX(M),b.getPointY(M),z),_=b.hasZ(M),y=b.hasM(M);return _&&(D.z=b.getPointZ(M)),y&&(D.m=b.getPointM(M)),D},exportPolygon:function x(b,M,z){return new v(b.exportPaths(M),z,b.hasZ(M),b.hasM(M))},exportPolyline:function i(b,M,z){return new a(b.exportPaths(M),z,b.hasZ(M),b.hasM(M))},exportMultipoint:function c(b,M,z){return new d(b.exportPoints(M),z,b.hasZ(M),b.hasM(M))},exportExtent:function S(b,M,z){const D=b.hasZ(M),_=b.hasM(M),y=new E(b.getXMin(M),b.getYMin(M),b.getXMax(M),b.getYMax(M),z);if(D){const m=b.getZExtent(M);y.zmin=m.vmin,y.zmax=m.vmax}if(_){const m=b.getMExtent(M);y.mmin=m.vmin,y.mmax=m.vmax}return y}};class p{constructor(M,z,D){this.x=M,this.y=z,this.spatialReference=D,this.z=void 0,this.m=void 0}}class v{constructor(M,z,D,_){this.rings=M,this.spatialReference=z,this.hasZ=void 0,this.hasM=void 0,D&&(this.hasZ=D),_&&(this.hasM=_)}}class a{constructor(M,z,D,_){this.paths=M,this.spatialReference=z,this.hasZ=void 0,this.hasM=void 0,D&&(this.hasZ=D),_&&(this.hasM=_)}}class d{constructor(M,z,D,_){this.points=M,this.spatialReference=z,this.hasZ=void 0,this.hasM=void 0,D&&(this.hasZ=D),_&&(this.hasM=_)}}class E{constructor(M,z,D,_,y){this.xmin=M,this.ymin=z,this.xmax=D,this.ymax=_,this.spatialReference=y,this.zmin=void 0,this.zmax=void 0,this.mmin=void 0,this.mmax=void 0}}},7848:(w,L,g)=>{g.d(L,{ym:()=>V,RF:()=>B,vY:()=>a,J9:()=>X,U1:()=>et,Ie:()=>st,G6:()=>rt});var C=g(62208),N=g(91179);const f=(r,t,l)=>[t,l],v=(r,t,l)=>[t,l,r[2]],x=(r,t,l)=>[t,l,r[2],r[3]];function a(r){return r?{originPosition:"upper-left"===r.originPosition?"upperLeft":"lower-left"===r.originPosition?"lowerLeft":r.originPosition,scale:r.tolerance?[r.tolerance,r.tolerance]:[1,1],translate:(0,C.pC)(r.extent)?[r.extent.xmin,r.extent.ymax]:[0,0]}:null}function d({scale:r,translate:t},l){return Math.round((l-t[0])/r[0])}function c({scale:r,translate:t},l){return Math.round((t[1]-l)/r[1])}function E(r,t,l){const O=[];let U,F,W,Z;for(let G=0;G<l.length;G++){const K=l[G];G>0?(W=d(r,K[0]),Z=c(r,K[1]),W===U&&Z===F||(O.push(t(K,W-U,Z-F)),U=W,F=Z)):(U=d(r,K[0]),F=c(r,K[1]),O.push(t(K,U,F)))}return O.length>0?O:null}function D({scale:r,translate:t},l){return l*r[0]+t[0]}function _({scale:r,translate:t},l){return t[1]-l*r[1]}function y(r,t,l){const O=new Array(l.length);if(!l.length)return O;const[U,F]=r.scale;let W=D(r,l[0][0]),Z=_(r,l[0][1]);O[0]=t(l[0],W,Z);for(let G=1;G<l.length;G++){const K=l[G];W+=K[0]*U,Z-=K[1]*F,O[G]=t(K,W,Z)}return O}function m(r,t,l){const O=new Array(l.length);for(let U=0;U<l.length;U++)O[U]=y(r,t,l[U]);return O}function B(r,t,l,O,U){return t.x=d(r,l.x),t.y=c(r,l.y),t!==l&&(O&&(t.z=l.z),U&&(t.m=l.m)),t}function V(r,t){return r&&t?(0,N.wp)(t)?B(r,{},t,!1,!1):(0,N.l9)(t)?function k(r,t,l,O,U){const F=function z(r,t,l,O){const U=[],F=l?O?x:v:O?v:f;for(let W=0;W<t.length;W++){const Z=E(r,F,t[W]);Z&&Z.length>=2&&U.push(Z)}return U.length?U:null}(r,l.paths,O,U);return F?(t.paths=F,t):null}(r,{},t,!1,!1):(0,N.oU)(t)?function Y(r,t,l,O,U){const F=function M(r,t,l,O){const U=[],F=l?O?x:v:O?v:f;for(let W=0;W<t.length;W++){const Z=E(r,F,t[W]);Z&&Z.length>=3&&U.push(Z)}return U.length?U:null}(r,l.rings,O,U);return F?(t.rings=F,t):null}(r,{},t,!1,!1):(0,N.aW)(t)?function R(r,t,l,O,U){return t.points=function b(r,t,l,O){return E(r,l?O?x:v:O?v:f,t)}(r,l.points,O,U),t}(r,{},t,!1,!1):(0,N.YX)(t)?function j(r,t,l,O,U){return t.xmin=d(r,l.xmin),t.ymin=c(r,l.ymin),t.xmax=d(r,l.xmax),t.ymax=c(r,l.ymax),t!==l&&(O&&(t.zmin=l.zmin,t.zmax=l.zmax),U&&(t.mmin=l.mmin,t.mmax=l.mmax)),t}(r,{},t,!1,!1):null:null}function X(r,t,l,O,U){return(0,C.pC)(l)&&(t.points=function I(r,t,l,O){return y(r,l?O?x:v:O?v:f,t)}(r,l.points,O,U)),t}function et(r,t,l,O,U){return(0,C.Wi)(l)||(t.x=D(r,l.x),t.y=_(r,l.y),t!==l&&(O&&(t.z=l.z),U&&(t.m=l.m))),t}function st(r,t,l,O,U){return(0,C.pC)(l)&&(t.rings=function s(r,t,l,O){return m(r,l?O?x:v:O?v:f,t)}(r,l.rings,O,U)),t}function rt(r,t,l,O,U){return(0,C.pC)(l)&&(t.paths=function e(r,t,l,O){return m(r,l?O?x:v:O?v:f,t)}(r,l.paths,O,U)),t}},77044:(w,L,g)=>{g.d(L,{Y:()=>p});var C=g(62208);function N(c,E){return c?E?4:3:E?3:2}function p(c,E,S,b,M){if((0,C.Wi)(E)||!E.lengths.length)return null;const z="upperLeft"===(null==M?void 0:M.originPosition)?-1:1;c.lengths.length&&(c.lengths.length=0),c.coords.length&&(c.coords.length=0);const D=c.coords,_=[],y=S?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:m,coords:u}=E,I=N(S,b);let e=0;for(const s of m){const h=f(y,u,e,s,S,b,z);h&&_.push(h),e+=s*I}if(_.sort((s,h)=>{let A=z*s[2]-z*h[2];return 0===A&&S&&(A=s[4]-h[4]),A}),_.length){let s=6*_[0][2];D[0]=_[0][0]/s,D[1]=_[0][1]/s,S&&(s=6*_[0][4],D[2]=0!==s?_[0][3]/s:0),(D[0]<y[0]||D[0]>y[1]||D[1]<y[2]||D[1]>y[3]||S&&(D[2]<y[4]||D[2]>y[5]))&&(D.length=0)}if(!D.length){const s=E.lengths[0]?function v(c,E,S,b,M){const z=N(b,M);let D=E,_=E+z,y=0,m=0,u=0,I=0;for(let e=0,s=S-1;e<s;e++,D+=z,_+=z){const h=c[D],A=c[D+1],o=c[D+2],T=c[_],P=c[_+1],j=c[_+2],R=b?a(h,A,o,T,P,j):x(h,A,T,P);if(R)if(y+=R,b){const B=d(h,A,o,T,P,j);m+=R*B[0],u+=R*B[1],I+=R*B[2]}else{const B=i(h,A,T,P);m+=R*B[0],u+=R*B[1]}}return y>0?b?[m/y,u/y,I/y]:[m/y,u/y]:S>0?b?[c[E],c[E+1],c[E+2]]:[c[E],c[E+1]]:null}(u,0,m[0],S,b):null;if(!s)return null;D[0]=s[0],D[1]=s[1],S&&s.length>2&&(D[2]=s[2])}return c}function f(c,E,S,b,M,z,D=1){const _=N(M,z);let y=S,m=S+_,u=0,I=0,e=0,s=0,h=0;for(let o=0,T=b-1;o<T;o++,y+=_,m+=_){const P=E[y],j=E[y+1],R=E[y+2],B=E[m],Y=E[m+1],k=E[m+2];let V=P*Y-B*j;s+=V,u+=(P+B)*V,I+=(j+Y)*V,M&&(V=P*k-B*R,e+=(R+k)*V,h+=V),P<c[0]&&(c[0]=P),P>c[1]&&(c[1]=P),j<c[2]&&(c[2]=j),j>c[3]&&(c[3]=j),M&&(R<c[4]&&(c[4]=R),R>c[5]&&(c[5]=R))}if(s*D>0&&(s*=-1),h*D>0&&(h*=-1),!s)return null;const A=[u,I,.5*s];return M&&(A[3]=e,A[4]=.5*h),A}function x(c,E,S,b){const M=S-c,z=b-E;return Math.sqrt(M*M+z*z)}function a(c,E,S,b,M,z){const D=b-c,_=M-E,y=z-S;return Math.sqrt(D*D+_*_+y*y)}function i(c,E,S,b){return[c+.5*(S-c),E+.5*(b-E)]}function d(c,E,S,b,M,z){return[c+.5*(b-c),E+.5*(M-E),S+.5*(z-S)]}},82959:(w,L,g)=>{g.d(L,{_W:()=>E,iV:()=>z,oj:()=>y});var C=g(15861),N=g(62208),p=g(56741),f=g(15994),v=g(37053),x=g(46367);const a=[0,0];function i(m,u){if(!u)return null;if("x"in u){const I={x:0,y:0};return[I.x,I.y]=m(u.x,u.y,a),null!=u.z&&(I.z=u.z),null!=u.m&&(I.m=u.m),I}if("xmin"in u){const I={xmin:0,ymin:0,xmax:0,ymax:0};return[I.xmin,I.ymin]=m(u.xmin,u.ymin,a),[I.xmax,I.ymax]=m(u.xmax,u.ymax,a),u.hasZ&&(I.zmin=u.zmin,I.zmax=u.zmax,I.hasZ=!0),u.hasM&&(I.mmin=u.mmin,I.mmax=u.mmax,I.hasM=!0),I}return"rings"in u?{rings:d(u.rings,m),hasM:u.hasM,hasZ:u.hasZ}:"paths"in u?{paths:d(u.paths,m),hasM:u.hasM,hasZ:u.hasZ}:"points"in u?{points:c(u.points,m),hasM:u.hasM,hasZ:u.hasZ}:void 0}function d(m,u){const I=[];for(const e of m)I.push(c(e,u));return I}function c(m,u){const I=[];for(const e of m){const s=u(e[0],e[1],[0,0]);I.push(s),e.length>2&&s.push(e[2]),e.length>3&&s.push(e[3])}return I}function E(m,u){return S.apply(this,arguments)}function S(){return(S=(0,C.Z)(function*(m,u){if(!u)return;const I=Array.isArray(m)?m.map(e=>(0,N.pC)(e.geometry)&&e.geometry.spatialReference):[m];yield(0,p.iQ)(I.map(e=>({source:e,dest:u})))})).apply(this,arguments)}const b=i.bind(null,x.hG),M=i.bind(null,x.R6);function z(m,u,I){return m&&(I||(I=u,u=m.spatialReference),(0,v.JY)(u)&&(0,v.JY)(I)&&!(0,v.fS)(u,I)?(0,x.Q8)(u,I)?(0,v.sS)(I)?b(m):M(m):(0,p.oj)(f.N,[m],u,I,null)[0]:m)}const _=new class D{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}push(u,I,e){var s=this;return(0,C.Z)(function*(){if(!u||!u.length||!I||!e||(0,v.fS)(I,e))return u;const h={geometries:u,inSpatialReference:I,outSpatialReference:e,resolve:null};return s._jobs.push(h),new Promise(A=>{h.resolve=A,null===s._timer&&(s._timer=setTimeout(s._process,10))})})()}_process(){this._timer=null;const u=this._jobs.shift();if(!u)return;const{geometries:I,inSpatialReference:e,outSpatialReference:s,resolve:h}=u;(0,x.Q8)(e,s)?(0,v.sS)(s)?h(I.map(b)):h(I.map(M)):h((0,p.oj)(f.N,I,e,s,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}};function y(m,u,I){return _.push(m,u,I)}},99666:(w,L,g)=>{g.d(L,{_I:()=>C,xp:()=>x,PX:()=>v,QS:()=>E,KS:()=>d,jL:()=>i,vs:()=>a,nE:()=>c});const C=8388607,N=8388608,v=0,x=1,a=S=>(S&N)>>>23,i=S=>S&C,d=S=>a(S)===x?254:255;function c(S){return a(S)===x}function E(S,b){return((b?N:0)|S)>>>0}},31982:(w,L,g)=>{g.d(L,{J:()=>N,g:()=>C});const C=(p,f)=>p&&((...v)=>f.warn("DEBUG:",...v))||(()=>null),N=!1},25310:(w,L,g)=>{g.d(L,{a:()=>x});var C=g(26584),N=g(63290),p=g(39406),f=g(64288);const v=N.Z.getLogger("esri.views.2d.engine.webgl");function x(a){return(0,f.hj)(a.minDataValue)&&(0,f.hj)(a.maxDataValue)&&null!=a.minSize&&null!=a.maxSize?p.X.SIZE_MINMAX_VALUE:(a.expression&&"view.scale"===a.expression||a.valueExpression&&"$view.scale"===a.valueExpression)&&Array.isArray(a.stops)?p.X.SIZE_SCALE_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&(Array.isArray(a.stops)||"levels"in a&&a.levels)?p.X.SIZE_FIELD_STOPS:(null!=a.field||a.expression&&"view.scale"!==a.expression||a.valueExpression&&"$view.scale"!==a.valueExpression)&&null!=a.valueUnit?p.X.SIZE_UNIT_VALUE:(v.error(new C.Z("mapview-bad-type","Found invalid size VisualVariable",a)),p.X.NONE)}},36682:(w,L,g)=>{g.d(L,{Z:()=>u});var C=g(15861),N=g(26584),p=g(8314),f=g(63290),v=g(21286),x=g(62208),a=g(10699),i=g(84682),d=g(60466),c=g(39351),E=g(99666),S=g(64288),b=g(31982),M=g(6257);const z=f.Z.getLogger("esri.views.layers.2d.features.support.AttributeStore"),D=(0,b.g)(b.J,z),_={sharedArrayBuffer:(0,p.Z)("esri-shared-array-buffer"),atomics:(0,p.Z)("esri-atomics")};function y(I,e){return s=>e(I(s))}class m{constructor(e,s,h,A){this.size=0,this.texelSize=4;const{pixelType:o,layout:T,textureOnly:P}=A;this.textureOnly=P||!1,this.pixelType=o,this._ctype=s,this.layout=T,this._resetRange(),this._shared=e,this.size=h,P||(this.data=this._initData(o,h,e,s))}get buffer(){return(0,x.Po)(this.data,e=>e.buffer)}unsetComponentAllTexels(e,s){const h=(0,x.Wg)(this.data);for(let A=0;A<this.size*this.size;A++)h[A*this.texelSize+e]&=~s;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponentAllTexels(e,s){const h=(0,x.Wg)(this.data);for(let A=0;A<this.size*this.size;A++)h[A*this.texelSize+e]|=255&s;this.dirtyStart=0,this.dirtyEnd=this.size*this.size-1}setComponent(e,s,h){const A=(0,x.Wg)(this.data);for(const o of h)A[o*this.texelSize+e]|=s,this.dirtyStart=Math.min(this.dirtyStart,o),this.dirtyEnd=Math.max(this.dirtyEnd,o)}setComponentTexel(e,s,h){(0,x.Wg)(this.data)[h*this.texelSize+e]|=s,this.dirtyStart=Math.min(this.dirtyStart,h),this.dirtyEnd=Math.max(this.dirtyEnd,h)}unsetComponentTexel(e,s,h){(0,x.Wg)(this.data)[h*this.texelSize+e]&=~s,this.dirtyStart=Math.min(this.dirtyStart,h),this.dirtyEnd=Math.max(this.dirtyEnd,h)}getData(e,s){const h=(0,E.jL)(e);return(0,x.Wg)(this.data)[h*this.texelSize+s]}setData(e,s,h){const A=(0,E.jL)(e);0!=(this.layout&1<<s)?(this.data[A*this.texelSize+s]=h,this.dirtyStart=Math.min(this.dirtyStart,A),this.dirtyEnd=Math.max(this.dirtyEnd,A)):z.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")}lock(){5121===this.pixelType&&this._shared&&_.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,1)}unlock(){5121===this.pixelType&&this._shared&&_.atomics&&"local"!==this._ctype&&Atomics.store(this.data,0,0)}expand(e){if(this.size=e,!this.textureOnly){const s=this._initData(this.pixelType,e,this._shared,this._ctype),h=(0,x.Wg)(this.data);s.set(h),this.data=s}}toMessage(){const e=this.dirtyStart,s=this.dirtyEnd,h=this.texelSize;if(e>s)return null;this._resetRange();const A=!(this._shared||"local"===this._ctype),o=this.pixelType,T=this.layout,P=(0,x.Wg)(this.data);return{start:e,end:s,data:A&&P.slice(e*h,(s+1)*h)||null,pixelType:o,layout:T}}_initData(e,s,h,A){const o=h&&"local"!==A?SharedArrayBuffer:ArrayBuffer,T=(0,S.UK)(e),P=new T(new o(s*s*4*T.BYTES_PER_ELEMENT));for(let j=0;j<P.length;j+=4)P[j+1]=255;return P}_resetRange(){this.dirtyStart=2147483647,this.dirtyEnd=0}}class u{constructor(e,s){this._client=e,this.config=s,this._attributeComputeMap=new Map,this._blocks=new Array,this._filters=new Array(c.m4),this._targetType=0,this._abortController=new AbortController,this._hasScaleExpr=!1,this._size=32,this._idsToHighlight=new Set;const h=s.supportsTextureFloat?5126:5121;D(`Creating AttributeStore ${_.sharedArrayBuffer?"with":"without"} shared memory`),this._blockDescriptors=[{pixelType:5121,layout:1},{pixelType:5121,layout:15,textureOnly:!0},{pixelType:h,layout:15},{pixelType:h,layout:15}],this._blocks=this._blockDescriptors.map(()=>null)}destroy(){this._abortController.abort()}get hasScaleExpr(){return this._hasScaleExpr}get _signal(){return this._abortController.signal}update(e,s){this.config=s;const h=s.schema.processors[0].storage,A=(0,i.Hg)(this._schema,h);if((e.targets.feature||e.targets.aggregate)&&(e.storage.data=!0),A&&((0,p.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:",A),e.storage.data=!0,this._schema=h,this._attributeComputeMap.clear(),!(0,x.Wi)(h))){switch(h.target){case"feature":this._targetType=E.PX;break;case"aggregate":this._targetType=E.xp}if("subtype"===h.type)for(const o in h.mapping){const T=h.mapping[o];if((0,x.pC)(T))for(const P of T.mapping)this._bindAttribute(P)}else for(const o of h.mapping)this._bindAttribute(o)}}onTileData(e,s){if((0,x.Wi)(s.addOrUpdate))return;const h=s.addOrUpdate.getCursor();for(;h.next();){const A=h.getDisplayId();this.setAttributeData(A,h)}}invalidateResources(){this._createResourcesPromise=null,this._abortController.abort(),this._abortController=new AbortController}setHighlight(e,s){var h=this;return(0,C.Z)(function*(){const o=h._getBlock(0),T=s.map(P=>(0,E.jL)(P));o.lock(),o.unsetComponentAllTexels(0,1),o.setComponent(0,1,T),o.unlock(),h._idsToHighlight.clear();for(const P of e)h._idsToHighlight.add(P);yield h.sendUpdates()})()}updateFilters(e,s){var h=this;return(0,C.Z)(function*(){const{config:A,service:o,spatialReference:T}=s,{filters:P}=A,j=P.map((R,B)=>h._updateFilter(R,B,o,T));(yield Promise.all(j)).some(R=>R)&&(e.storage.filters=!0,(0,p.Z)("esri-2d-update-debug")&&console.debug("Applying Update - AttributeStore:","Filters changed"))})()}setData(e,s,h,A){const o=(0,E.jL)(e);this._ensureSizeForTexel(o),this._getBlock(s).setData(e,h,A)}getData(e,s,h){return this._getBlock(s).getData(e,h)}getHighlightFlag(e){return this._idsToHighlight.has(e)?c.uG:0}unsetAttributeData(e){const s=(0,E.jL)(e);this._getBlock(0).setData(s,0,0)}setAttributeData(e,s){const h=(0,E.jL)(e);if(this._ensureSizeForTexel(h),this._getBlock(0).setData(h,0,this.getFilterFlags(s)),this._targetType!==(0,E.vs)(e))return;const A=this._attributeComputeMap,o=this.config.supportsTextureFloat?1:2;A.size&&A.forEach((P,j)=>{const R=j*o%4,B=Math.floor(j*o/4),Y=this._getBlock(B+c.aK),k=P(s);if(this.config.supportsTextureFloat)Y.setData(h,R,k);else if(k===c.AI)Y.setData(h,R,255),Y.setData(h,R+1,255);else{const V=(0,v.uZ)(Math.round(k),-32767,32766)+32768,X=(65280&V)>>8;Y.setData(h,R,255&V),Y.setData(h,R+1,X)}})}sendUpdates(){if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=(0,a.hh)(),this._nextUpdate.promise;const e={blocks:this._blocks.map(s=>(0,x.pC)(s)?s.toMessage():null)};return this._currUpdate=this._createResources().then(()=>{const s=()=>{if(this._currUpdate=null,this._nextUpdate){const A=this._nextUpdate;this._nextUpdate=null,this.sendUpdates().then(()=>A.resolve())}},h=this._client.update(e,this._signal).then(s).catch(s);return this._client.render(this._signal),h}).catch(s=>(0,a.D_)(s)?(this._createResourcesPromise=null,this._createResources()):(z.error(new N.Z("mapview-attribute-store","Encountered an error during client update",s)),Promise.resolve())),this._currUpdate}_ensureSizeForTexel(e){for(;e>=this._size*this._size;)if(this._expand())return}_bindAttribute(e){let A;if(null!=e.fieldIndex)A=function h(){return e.normalizationField&&z.warn("mapview-arcade","Ignoring normalizationField specified with an arcade expression which is not supported."),T=>T.getComputedNumericAtIndex(e.fieldIndex)}();else{if(!e.field)return;A=function s(){return e.normalizationField?T=>{const P=T.readAttribute(e.normalizationField);return P?T.readAttribute(e.field)/P:null}:T=>T.readAttribute(e.field)}()}e.valueRepresentation&&(A=y(A,T=>(0,M.qc)(T,e.valueRepresentation))),this._attributeComputeMap.set(e.binding,y(A,T=>null===T||isNaN(T)||T===1/0?c.AI:T))}_createResources(){if((0,x.pC)(this._createResourcesPromise))return this._createResourcesPromise;this._getBlock(c.xl),D("Initializing AttributeStore");const e={shared:_.sharedArrayBuffer&&"local"!==this._client.type,size:this._size,blocks:(0,x.Fd)(this._blocks,h=>({textureOnly:h.textureOnly,buffer:h.buffer,pixelType:h.pixelType}))},s=this._client.initialize(e,this._signal).catch(h=>{(0,a.D_)(h)?this._createResourcesPromise=null:z.error(new N.Z("mapview-attribute-store","Encountered an error during client initialization",h))});return this._createResourcesPromise=s,s.then(()=>(0,x.Wi)(this._createResourcesPromise)?this._createResources():void 0),s}_getBlock(e){const s=this._blocks[e];if((0,x.pC)(s))return s;D(`Initializing AttributeBlock at index ${e}`);const o=new m(_.sharedArrayBuffer,this._client.type,this._size,this._blockDescriptors[e]);return this._blocks[e]=o,this._createResourcesPromise=null,o}_expand(){if(this._size<this.config.maxTextureSize){const e=this._size<<=1;return D("Expanding block size to",e,this._blocks),(0,x.JR)(this._blocks,s=>s.expand(e)),this._createResourcesPromise=null,this._size=e,0}return z.error(new N.Z("mapview-limitations","Maximum number of onscreen features exceeded.")),-1}_updateFilter(e,s,h,A){var o=this;return(0,C.Z)(function*(){const T=o._filters[s],P=(0,x.pC)(T)&&T.hash;if(!T&&!e||P===JSON.stringify(e))return!1;if((0,x.Wi)(e)){if(!T)return!1;const R=1<<s+1,B=o._getBlock(0);return o._filters[s]=null,B.setComponentAllTexels(0,R),o.sendUpdates(),!0}return yield(yield o._getFilter(s,h)).update(e,A),!0})()}_getFilter(e,s){var h=this;return(0,C.Z)(function*(){const A=h._filters[e];if((0,x.pC)(A))return A;const{default:o}=yield Promise.all([g.e(8592),g.e(8967)]).then(g.bind(g,8967)),T=new o({geometryType:s.geometryType,hasM:!1,hasZ:!1,timeInfo:s.timeInfo,fieldsIndex:new d.Z(s.fields)});return h._filters[e]=T,T})()}isVisible(e){return!!(2&this._getBlock(0).getData(e,0))}getFilterFlags(e){let s=0;const h=(0,E.KS)(e.getDisplayId());for(let o=0;o<this._filters.length;o++){const P=this._filters[o];s|=(h&1<<o&&!(0,x.Wi)(P)&&!P.check(e)?0:1)<<o}let A=0;if(this._idsToHighlight.size){const o=e.getObjectId();A=this.getHighlightFlag(o)}return s<<1|A}}},93872:(w,L,g)=>{g.d(L,{O:()=>v});var C=g(99666);class N{constructor(){this._freeIds=[],this._idCounter=1}createId(a=!1){return(0,C.QS)(this._getFreeId(),a)}releaseId(a){this._freeIds.push(a)}_getFreeId(){return this._freeIds.length?this._freeIds.pop():this._idCounter++}}var p=g(42797);function f(x,a,i){if(!(x.length>a))for(;x.length<=a;)x.push(i)}class v{constructor(){this._numerics=[],this._strings=[],this._idGenerator=new N,this._allocatedSize=256,this._bitsets=[],this._instanceIds=[],this._bounds=[]}createBitset(){const a=this._bitsets.length;return this._bitsets.push(p.p.create(this._allocatedSize,C._I)),a+1}getBitset(a){return this._bitsets[a-1]}_expand(){this._allocatedSize<<=1;for(const a of this._bitsets)a.resize(this._allocatedSize)}_ensureNumeric(a,i){this._numerics[a]||(this._numerics[a]=[]),f(this._numerics[a],i,0)}_ensureInstanceId(a){f(this._instanceIds,a,0)}_ensureString(a,i){this._strings[a]||(this._strings[a]=[]),f(this._strings[a],i,null)}createDisplayId(a=!1){const i=this._idGenerator.createId();return i>this._allocatedSize&&this._expand(),(0,C.QS)(i,a)}releaseDisplayId(a){for(const i of this._bitsets)i.unset(a);return this._idGenerator.releaseId(a&C._I)}getComputedNumeric(a,i){return this.getComputedNumericAtIndex(a&C._I,0)}setComputedNumeric(a,i,d){return this.setComputedNumericAtIndex(a&C._I,d,0)}getComputedString(a,i){return this.getComputedStringAtIndex(a&C._I,0)}setComputedString(a,i,d){return this.setComputedStringAtIndex(a&C._I,0,d)}getComputedNumericAtIndex(a,i){const d=a&C._I;return this._ensureNumeric(i,d),this._numerics[i][d]}setComputedNumericAtIndex(a,i,d){const c=a&C._I;this._ensureNumeric(i,c),this._numerics[i][c]=d}getInstanceId(a){const i=a&C._I;return this._ensureInstanceId(i),this._instanceIds[i]}setInstanceId(a,i){const d=a&C._I;this._ensureInstanceId(d),this._instanceIds[d]=i}getComputedStringAtIndex(a,i){const d=a&C._I;return this._ensureString(i,d),this._strings[i][d]}setComputedStringAtIndex(a,i,d){const c=a&C._I;this._ensureString(i,c),this._strings[i][c]=d}getXMin(a){return this._bounds[4*(a&C._I)]}getYMin(a){return this._bounds[4*(a&C._I)+1]}getXMax(a){return this._bounds[4*(a&C._I)+2]}getYMax(a){return this._bounds[4*(a&C._I)+3]}setBounds(a,i){const d=i.readHydratedGeometry();if(!d||!d.coords.length)return!1;let c=1/0,E=1/0,S=-1/0,b=-1/0;d.forEachVertex((z,D)=>{c=Math.min(c,z),E=Math.min(E,D),S=Math.max(S,z),b=Math.max(b,D)});const M=a&C._I;return f(this._bounds,4*M+4,0),this._bounds[4*M]=c,this._bounds[4*M+1]=E,this._bounds[4*M+2]=S,this._bounds[4*M+3]=b,!0}}},25208:(w,L,g)=>{g.d(L,{s:()=>h}),g(29132);var d,c,E,N=g(8314),p=g(62208),f=g(77044),v=g(82054),x=g(88071),a=g(42797),i=g(91179);let S=0;const b=null!=(d=(0,N.Z)("featurelayer-simplify-thresholds"))?d:[.5,.5,.5,.5],M=b[0],z=b[1],D=b[2],_=b[3],y=null!=(c=(0,N.Z)("featurelayer-simplify-payload-size-factors"))?c:[1,2,4],m=y[0],u=y[1],I=y[2],e=null!=(E=(0,N.Z)("featurelayer-simplify-mobile-factor"))?E:2,s=(0,N.Z)("esri-mobile");class h{constructor(o){this.type="FeatureSetReader",this.seen=!1,this.instance=0,this._tx=0,this._ty=0,this._sx=1,this._sy=1,this._deleted=null,this._joined=[],this._objectIdToIndex=null,this._level=0,this.instance=o}static createInstance(){return S++,S=S>65535?0:S,S}get isEmpty(){return(0,p.pC)(this._deleted)&&this._deleted.countSet()===this.getSize()}set level(o){this._level=o}getAreaSimplificationThreshold(o,T){let P=1;const j=s?e:1;T>4e6?P=I*j:T>1e6?P=u*j:T>5e5?P=m*j:T>1e5&&(P=j);let R=0;o>4e3?R=_*P:o>2e3?R=D*P:o>100?R=z:o>15&&(R=M);let B=8;return this._level<4?B=1:this._level<5?B=2:this._level<6&&(B=4),R*B}setArcadeSpatialReference(o){this._arcadeSpatialReference=o}attachStorage(o){this._storage=o}getQuantizationTransform(){throw new Error("Unable to find transform for featureSet")}getStorage(){return this._storage}getComputedNumeric(o){return this.getComputedNumericAtIndex(0)}setComputedNumeric(o,T){return this.setComputedNumericAtIndex(T,0)}getComputedString(o){return this.getComputedStringAtIndex(0)}setComputedString(o,T){return this.setComputedStringAtIndex(0,T)}getComputedNumericAtIndex(o){return this._storage.getComputedNumericAtIndex(this.getDisplayId(),o)}setComputedNumericAtIndex(o,T){this._storage.setComputedNumericAtIndex(this.getDisplayId(),o,T)}getComputedStringAtIndex(o){return this._storage.getComputedStringAtIndex(this.getDisplayId(),o)}setComputedStringAtIndex(o,T){return this._storage.setComputedStringAtIndex(this.getDisplayId(),o,T)}transform(o,T,P,j){const R=this.copy();return R._tx+=o,R._ty+=T,R._sx*=P,R._sy*=j,R}readAttribute(o,T=!1){const P=this._readAttribute(o,T);if(void 0!==P)return P;for(const j of this._joined){j.setIndex(this.getIndex());const R=j._readAttribute(o,T);if(void 0!==R)return R}}readAttributes(){const o=this._readAttributes();for(const T of this._joined){T.setIndex(this.getIndex());const P=T._readAttributes();for(const j of Object.keys(P))o[j]=P[j]}return o}joinAttributes(o){this._joined.push(o)}readArcadeFeature(){return this}geometry(){const o=this.readHydratedGeometry(),T=(0,v.di)(o,this.geometryType,this.hasZ,this.hasM),P=(0,i.im)(T);return P&&(P.spatialReference=this._arcadeSpatialReference),P}field(o){return this.readAttribute(o,!0)}hasField(o){return!0}setField(o,T){}keys(){return[]}castToText(){return""}removeIds(o){if((0,p.Wi)(this._objectIdToIndex)){const P=new Map,j=this.getCursor();for(;j.next();)P.set(j.getObjectId(),j.getIndex());this._objectIdToIndex=P}const T=this._objectIdToIndex;for(const P of o)T.has(P)&&this.removeAtIndex(T.get(P))}removeAtIndex(o){(0,p.Wi)(this._deleted)&&(this._deleted=a.p.create(this.getSize())),this._deleted.set(o)}readGeometryForDisplay(){return this.readUnquantizedGeometry(!0)}readLegacyGeometryForDisplay(){return this.readLegacyGeometry(!0)}*features(){const o=this.getCursor();for(;o.next();)yield o.readOptimizedFeature()}_getExists(){return(0,p.Wi)(this._deleted)||!this._deleted.has(this.getIndex())}_computeCentroid(){if("esriGeometryPolygon"!==this.geometryType)return null;const o=this.readUnquantizedGeometry();if(!o||o.hasIndeterminateRingOrder)return null;const T=(0,p.Pt)(this.getQuantizationTransform(),null);return(0,f.Y)(new x.Z,o,this.hasM,this.hasZ,T)}copyInto(o){o.seen=this.seen,o._storage=this._storage,o._arcadeSpatialReference=this._arcadeSpatialReference,o._joined=this._joined,o._tx=this._tx,o._ty=this._ty,o._sx=this._sx,o._sy=this._sy,o._deleted=this._deleted,o._objectIdToIndex=this._objectIdToIndex}}},64822:(w,L,g)=>{g.d(L,{i:()=>x});var C=g(62208),N=g(82054),p=g(66385),f=g(25208);class x extends f.s{constructor(i,d,c){super(i),this._featureIndex=-1,this._dateFields=new Set,this._geometryType=c,this._features=d}static fromFeatures(i,d,c){const E=(0,N.Yn)([],i,d,!1,!1,c);for(let S=0;S<E.length;S++)E[S].displayId=i[S].displayId;return x.fromOptimizedFeatures(E,d)}static fromFeatureSet(i,d){const c=(0,N.h_)(i,d);return x.fromOptimizedFeatureSet(c)}static fromOptimizedFeatureSet(i){const{features:d,geometryType:c}=i,E=x.fromOptimizedFeatures(d,c);E._exceededTransferLimit=i.exceededTransferLimit,E._transform=i.transform;for(const S of i.fields)"esriFieldTypeDate"===S.type&&E._dateFields.add(S.name);return E}static fromOptimizedFeatures(i,d,c){const E=f.s.createInstance(),S=new x(E,i,d);return S._transform=c,S}get _current(){return this._features[this._featureIndex]}get geometryType(){return this._geometryType}get hasFeatures(){return!!this._features.length}get hasNext(){return this._featureIndex+1<this._features.length}get exceededTransferLimit(){return this._exceededTransferLimit}get hasZ(){return!1}get hasM(){return!1}removeIds(i){const d=new Set(i);this._features=this._features.filter(c=>!d.has(c.objectId))}append(i){for(const d of i)this._features.push(d)}getSize(){return this._features.length}getCursor(){return this.copy()}getQuantizationTransform(){return this._transform}getAttributeHash(){let i="";for(const d in this._current.attributes)i+=this._current.attributes[d];return i}getIndex(){return this._featureIndex}setIndex(i){this._featureIndex=i}getObjectId(){return this._current.objectId}getDisplayId(){return this._current.displayId}setDisplayId(i){this._current.displayId=i}getGroupId(){return this._current.groupId}setGroupId(i){this._current.groupId=i}copy(){const i=new x(this.instance,this._features,this.geometryType);return this.copyInto(i),i}next(){for(;++this._featureIndex<this._features.length&&!this._getExists(););return this._featureIndex<this._features.length}readLegacyFeature(){return(0,N.EI)(this._current,this.geometryType,this.hasZ,this.hasM)}readOptimizedFeature(){return this._current}readLegacyPointGeometry(){return this.readGeometry()?{x:this.getX(),y:this.getY()}:null}readLegacyGeometry(){const i=this.readGeometry();return(0,N.di)(i,this.geometryType,this.hasZ,this.hasM)}readLegacyCentroid(){const i=this.readCentroid();return(0,C.Wi)(i)?null:{x:i.coords[0]*this._sx+this._tx,y:i.coords[1]*this._sy+this._ty}}readGeometryArea(){return(0,p.S6)(this._current)?(0,N.lz)(this._current.geometry,2):0}readUnquantizedGeometry(){const i=this.readGeometry();if("esriGeometryPoint"===this.geometryType||!i)return i;const d=i.clone();return function v({coords:a,lengths:i}){let d=0;for(const c of i){for(let E=1;E<c;E++)a[2*(d+E)]+=a[2*(d+E)-2],a[2*(d+E)+1]+=a[2*(d+E)-1];d+=c}}(d),d}readHydratedGeometry(){const i=this._current.geometry;if((0,C.Wi)(i))return null;const d=i.clone();return(0,C.pC)(this._transform)&&(0,N.$g)(d,d,this.hasZ,this.hasM,this._transform),d}getXHydrated(){if(!(0,p.S6)(this._current))return 0;const i=this._current.geometry.coords[0],d=this.getQuantizationTransform();return(0,C.Wi)(d)?i:i*d.scale[0]+d.translate[0]}getYHydrated(){if(!(0,p.S6)(this._current))return 0;const i=this._current.geometry.coords[1],d=this.getQuantizationTransform();return(0,C.Wi)(d)?i:d.translate[1]-i*d.scale[1]}getX(){return(0,p.S6)(this._current)?this._current.geometry.coords[0]*this._sx+this._tx:0}getY(){return(0,p.S6)(this._current)?this._current.geometry.coords[1]*this._sy+this._ty:0}readGeometry(){if(!(0,p.S6)(this._current))return null;const i=this._current.geometry.clone();if(i.isPoint)return i.coords[0]=i.coords[0]*this._sx+this._tx,i.coords[1]=i.coords[1]*this._sy+this._ty,i;let d=0;for(const c of i.lengths)i.coords[2*d]=i.coords[2*d]*this._sx+this._tx,i.coords[2*d+1]=i.coords[2*d+1]*this._sy+this._ty,d+=c;return i}readCentroid(){if(!(0,p.S6)(this._current))return null;if(!this._current.centroid){const d=this._computeCentroid();if(!d)return null;d.coords[0]=(d.coords[0]-this._tx)/this._sx,d.coords[1]=(d.coords[1]-this._ty)/this._sy,this._current.centroid=d}const i=this._current.centroid.clone();return i.coords[0]=i.coords[0]*this._sx+this._tx,i.coords[1]=i.coords[1]*this._sx+this._ty,i}_readAttribute(i,d){const c=this._current.attributes[i];if(void 0!==c)return null!=c&&d&&this._dateFields.has(i)?new Date(c):c;const E=this.readAttributes(),S=i.toLocaleLowerCase().trim();for(const b in E)if(b.toLocaleLowerCase().trim()===S){const M=this._current.attributes[b];return null!=M&&d&&this._dateFields.has(b)?new Date(M):M}}copyInto(i){super.copyInto(i),i._featureIndex=this._featureIndex,i._transform=this._transform,i._dateFields=this._dateFields}_readAttributes(){return this._current.attributes}}},42797:(w,L,g)=>{g.d(L,{p:()=>C});class C{constructor(p,f){this._mask=0,this._buf=p,this._mask=f}static fromBuffer(p,f){return new C(p,f)}static create(p,f=4294967295){const v=new Uint32Array(Math.ceil(p/32));return new C(v,f)}_getIndex(p){return Math.floor(p/32)}has(p){const f=this._mask&p;return!!(this._buf[this._getIndex(f)]&1<<f%32)}hasRange(p,f){let v=p,x=f;for(;v%32&&v!==x;){if(this.has(v))return!0;v++}for(;x%32&&v!==x;){if(this.has(v))return!0;x--}if(v===x)return!1;for(let a=v/32;a!==x/32;a++)if(this._buf[a])return!0;return!1}set(p){const f=this._mask&p,v=this._getIndex(f);this._buf[v]|=1<<f%32}setRange(p,f){let v=p,x=f;for(;v%32&&v!==x;)this.set(v++);for(;x%32&&v!==x;)this.set(x--);if(v!==x)for(let a=v/32;a!==x/32;a++)this._buf[a]=4294967295}unset(p){const f=this._mask&p,v=this._getIndex(f);this._buf[v]&=4294967295^1<<f%32}resize(p){const f=this._buf,v=new Uint32Array(Math.ceil(p/32));v.set(f),this._buf=v}or(p){for(let f=0;f<this._buf.length;f++)this._buf[f]|=p._buf[f];return this}and(p){for(let f=0;f<this._buf.length;f++)this._buf[f]&=p._buf[f];return this}xor(p){for(let f=0;f<this._buf.length;f++)this._buf[f]^=p._buf[f];return this}ior(p){for(let f=0;f<this._buf.length;f++)this._buf[f]|=~p._buf[f];return this}iand(p){for(let f=0;f<this._buf.length;f++)this._buf[f]&=~p._buf[f];return this}ixor(p){for(let f=0;f<this._buf.length;f++)this._buf[f]^=~p._buf[f];return this}any(){for(let p=0;p<this._buf.length;p++)if(this._buf[p])return!0;return!1}copy(p){for(let f=0;f<this._buf.length;f++)this._buf[f]=p._buf[f];return this}clone(){return new C(this._buf.slice(),this._mask)}clear(){for(let p=0;p<this._buf.length;p++)this._buf[p]=0}forEachSet(p){for(let f=0;f<this._buf.length;f++){let v=this._buf[f],x=32*f;if(v)for(;v;)1&v&&p(x),v>>>=1,x++}}countSet(){let p=0;return this.forEachSet(f=>{p++}),p}}},6257:(w,L,g)=>{g.d(L,{I:()=>b,qc:()=>a});var C=g(62208),N=g(23841),p=g(81295),f=g(39351),v=g(39406),x=g(25310);function a(_,y){if(!_||!y)return _;switch(y){case"radius":case"distance":return 2*_;case"diameter":case"width":return _;case"area":return Math.sqrt(_)}return _}function d(_){return _.map(y=>function i(_){return{value:_.value,size:(0,N.t_)(_.size)}}(y))}function c(_){return"string"==typeof _||"number"==typeof _?(0,N.t_)(_):{type:"size",expression:_.expression,stops:d(_.stops)}}const S=_=>{const y=[],m=[],u=d(_),I=u.length;for(let e=0;e<6;e++){const s=u[Math.min(e,I-1)];y.push(s.value),m.push(null==s.size?f.AI:(0,N.F2)(s.size))}return{values:new Float32Array(y),sizes:new Float32Array(m)}};function b(_){const y=_&&_.length>0?{}:null,m=y?{}:null;if(!y)return{vvFields:y,vvRanges:m};for(const u of _)if(u.field&&(y[u.type]=u.field),"size"===u.type){m.size||(m.size={});const I=u;switch((0,x.a)(I)){case v.X.SIZE_MINMAX_VALUE:m.size.minMaxValue={minDataValue:I.minDataValue,maxDataValue:I.maxDataValue,minSize:c(I.minSize),maxSize:c(I.maxSize)};break;case v.X.SIZE_SCALE_STOPS:m.size.scaleStops={stops:d(I.stops)};break;case v.X.SIZE_FIELD_STOPS:if(I.levels){const e={};for(const s in I.levels)e[s]=S(I.levels[s]);m.size.fieldStops={type:"level-dependent",levels:e}}else m.size.fieldStops=tt({type:"static"},S(I.stops));break;case v.X.SIZE_UNIT_VALUE:m.size.unitValue={unit:I.valueUnit,valueRepresentation:I.valueRepresentation}}}else"color"===u.type?m.color=D(u):"opacity"===u.type?m.opacity=M(u):"rotation"===u.type&&(m.rotation={type:u.rotationType});return{vvFields:y,vvRanges:m}}function M(_){const y={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if("string"==typeof _.field){if(!_.stops)return null;{if(_.stops.length>8)return null;const m=_.stops;for(let u=0;u<8;++u){const I=m[Math.min(u,m.length-1)];y.values[u]=I.value,y.opacities[u]=I.opacity}}}else{if(!(_.stops&&_.stops.length>=0))return null;{const m=_.stops&&_.stops.length>=0&&_.stops[0].opacity;for(let u=0;u<8;u++)y.values[u]=1/0,y.opacities[u]=m}}return y}function z(_,y,m){_[4*y+0]=m.r/255,_[4*y+1]=m.g/255,_[4*y+2]=m.b/255,_[4*y+3]=m.a}function D(_){if((0,C.Wi)(_)||_.normalizationField)return null;const y={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};if("string"==typeof _.field){if(!_.stops)return null;{if(_.stops.length>8)return null;y.field=_.field;const m=_.stops;for(let u=0;u<8;++u){const I=m[Math.min(u,m.length-1)];y.values[u]=I.value,z(y.colors,u,I.color)}}}else{if(!(_.stops&&_.stops.length>=0))return null;{const m=_.stops&&_.stops.length>=0&&_.stops[0].color;for(let u=0;u<8;u++)y.values[u]=1/0,z(y.colors,u,m)}}for(let m=0;m<32;m+=4)(0,p.pr)(y.colors,m,!0);return y}}}]);