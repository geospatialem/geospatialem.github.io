"use strict";var X=Object.defineProperty,$=Object.defineProperties,q=Object.getOwnPropertyDescriptors,z=Object.getOwnPropertySymbols,k=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,j=(m,h,i)=>h in m?X(m,h,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[h]=i,O=(m,h)=>{for(var i in h||(h={}))k.call(h,i)&&j(m,i,h[i]);if(z)for(var i of z(h))_.call(h,i)&&j(m,i,h[i]);return m},A=(m,h)=>$(m,q(h));(self.webpackChunksite=self.webpackChunksite||[]).push([[5391],{22264:(m,h,i)=>{function v(l,a){return a?"xoffset"in a&&a.xoffset?Math.max(l,Math.abs(a.xoffset)):"yoffset"in a&&a.yoffset?Math.max(l,Math.abs(a.yoffset||0)):l:l}function g(l,a){return"number"==typeof l?l:l&&l.stops&&l.stops.length?function I(l){let a=0,u=0;for(let c=0;c<l.length;c++){const o=l[c].size;"number"==typeof o&&(a+=o,u++)}return a/u}(l.stops):a}function T(l){const a=l&&l.renderer,u="touch"===(l&&l.event&&l.event.pointerType)?9:6;if(!a)return u;const c="visualVariables"in a?function M(l,a){if(!a)return l;const u=a.filter(p=>"size"===p.type).map(p=>{const{maxSize:w,minSize:P}=p;return(g(w,l)+g(P,l))/2});let c=0;const o=u.length;if(0===o)return l;for(let p=0;p<o;p++)c+=u[p];const f=Math.floor(c/o);return Math.max(f,l)}(u,a.visualVariables):u;if("simple"===a.type)return v(c,a.symbol);if("unique-value"===a.type){let o=c;return a.uniqueValueInfos.forEach(f=>{o=v(o,f.symbol)}),o}if("class-breaks"===a.type){let o=c;return a.classBreakInfos.forEach(f=>{o=v(o,f.symbol)}),o}return c}i.d(h,{k:()=>T})},55391:(m,h,i)=>{i.r(h),i.d(h,{default:()=>H});var v=i(15861),I=i(17626),g=i(26584),M=i(63290),T=i(10699),l=i(77712),o=(i(85931),i(8314),i(90912),i(76898)),f=i(91082),p=i(37384),w=i(88893),P=i(9598),R=i(58098),L=i(8480),D=i(79527),F=i(45611),S=i(94421),B=i(62208),K=i(22264);const W=e=>{let r=class extends e{fetchPopupFeatures(s,Z){var V=this;return(0,v.Z)(function*(){const{layer:U}=V;if(!s)return Promise.reject(new g.Z("tilelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:U}));if("tile"!==U.type)return Promise.reject(new g.Z("tilelayerview:fetchPopupFeatures","Layer type should be 'tile'",{type:U.type}));const E=V.get("view.scale"),C=U.allSublayers.toArray().filter(y=>y.popupTemplate&&y.popupEnabled&&y.visible&&(0===y.minScale||E<=y.minScale)&&(0===y.maxScale||E>=y.maxScale));return(0,T.as)(C.map(function(){var y=(0,v.Z)(function*(d){const x=d.createQuery(),b=(0,B.pC)(Z)?Z.event:null,J=(0,K.k)({renderer:d.renderer,event:b});return x.geometry=V.createFetchPopupFeaturesQueryGeometry(s,J),x.outFields=yield d.popupTemplate.getRequiredFields(),(yield d.queryFeatures(x)).features});return function(d){return y.apply(this,arguments)}}())).then(y=>[].concat(...y.map(d=>d.value).filter(Boolean)))})()}};return(0,I._)([(0,l.Cb)()],r.prototype,"layer",void 0),r=(0,I._)([(0,o.j)("esri.layers.mixins.TileLayerView")],r),r};var G=i(94672);const N=M.Z.getLogger("esri.views.2d.layers.TileLayerView2D"),Y=[0,0];let Q=class extends(W((0,S.y)((0,f.Y)((0,p.y)(F.Z))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,r=e&&e.spatialReference;let s;r||(s=new g.Z("layerview:tiling-information-missing","The layer doesn't provide tiling information",{layer:this.layer})),r.equals(this.view.spatialReference)||(s=new g.Z("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer})),this.watch("resampling",()=>{this.doRefresh()}),s&&this.addResolvingPromise(Promise.reject(s))}get resampling(){return!("resampling"in this.layer)||!1!==this.layer.resampling}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange("updating")}attach(){const e="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new P.Z(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new L.Z({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(r,s)=>this.fetchTile(r,s)}),this._tileStrategy=new D.Z({cachePolicy:"keep",resampling:this.resampling,acquireTile:r=>this.acquireTile(r),releaseTile:r=>this.releaseTile(r),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,r){return(0,G.K)(e,r,this.view)}doRefresh(){var e=this;return(0,v.Z)(function*(){e.updateRequested||e.suspended||(e._fetchQueue.reset(),e._tileStrategy.tiles.forEach(r=>e._enqueueTileFetch(r)),e.notifyChange("updating"))})()}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const r=this._bitmapView.createTile(e),s=r.bitmap;return[s.x,s.y]=this._tileInfoView.getTileCoords(Y,r.key),s.resolution=this._tileInfoView.getTileResolution(r.key),[s.width,s.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(r),this._bitmapView.addChild(r),this.requestUpdate(),r}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once("detach",()=>e.destroy()),this.requestUpdate()}fetchTile(e,r={}){var s=this;return(0,v.Z)(function*(){const Z="tilemapCache"in s.layer?s.layer.tilemapCache:null,{signal:V,resamplingLevel:U=0}=r;if(!Z)try{return yield s._fetchImage(e,V)}catch(y){if(!(0,T.D_)(y)&&!s.resampling)return(0,w.V)(s._tileInfoView.tileInfo.size);if(U<3){const d=s._tileInfoView.getTileParentId(e.id);if(d){const x=new R.Z(d),b=yield s.fetchTile(x,A(O({},r),{resamplingLevel:U+1}));return(0,w.i)(s._tileInfoView,b,x,e)}}throw y}const E=new R.Z(0,0,0,0);let C;try{if(yield Z.fetchAvailabilityUpsample(e.level,e.row,e.col,E,{signal:V}),E.level!==e.level&&!s.resampling)return(0,w.V)(s._tileInfoView.tileInfo.size);C=yield s._fetchImage(E,V)}catch(y){if((0,T.D_)(y))throw y;C=yield s._fetchImage(e,V)}return s.resampling?(0,w.i)(s._tileInfoView,C,E,e):C})()}_enqueueTileFetch(e){var r=this;return(0,v.Z)(function*(){if(!r._fetchQueue.has(e.key.id)){try{const s=yield r._fetchQueue.push(e.key);e.bitmap.source=s,e.bitmap.width=r._tileInfoView.tileInfo.size[0],e.bitmap.height=r._tileInfoView.tileInfo.size[1],e.once("attach",()=>r.requestUpdate())}catch(s){(0,T.D_)(s)||N.error(s)}r.requestUpdate()}})()}_fetchImage(e,r){var s=this;return(0,v.Z)(function*(){return s.layer.fetchTile(e.level,e.row,e.col,{signal:r})})()}};(0,I._)([(0,l.Cb)()],Q.prototype,"resampling",null),Q=(0,I._)([(0,o.j)("esri.views.2d.layers.TileLayerView2D")],Q);const H=Q},94672:(m,h,i)=>{i.d(h,{K:()=>T}),i(29132);var I=i(62208),g=i(16730),M=i(2004);function T(u,c,o,f=new M.Z){let p;if("2d"===o.type)p=c*o.resolution;else if("3d"===o.type){const F=o.overlayPixelSizeInMapUnits(u),S=o.basemapSpatialReference;p=(0,I.pC)(S)&&!S.equals(o.spatialReference)?(0,g.c9)(S)/(0,g.c9)(o.spatialReference):c*F}const w=u.x-p,P=u.y-p,R=u.x+p,L=u.y+p,{spatialReference:D}=o;return f.xmin=Math.min(w,R),f.ymin=Math.min(P,L),f.xmax=Math.max(w,R),f.ymax=Math.max(P,L),f.spatialReference=D,f}new M.Z}}]);