"use strict";var ve=Object.defineProperty,J=Object.getOwnPropertySymbols,Ie=Object.prototype.hasOwnProperty,Ne=Object.prototype.propertyIsEnumerable,K=(I,m,o)=>m in I?ve(I,m,{enumerable:!0,configurable:!0,writable:!0,value:o}):I[m]=o,D=(I,m)=>{for(var o in m||(m={}))Ie.call(m,o)&&K(I,o,m[o]);if(J)for(var o of J(m))Ne.call(m,o)&&K(I,o,m[o]);return I};(self.webpackChunksite=self.webpackChunksite||[]).push([[9155],{39155:(I,m,o)=>{o.r(m),o.d(m,{default:()=>fe,inferFieldType:()=>$,inferFields:()=>B,inferLocationInfo:()=>Q});var y=o(15861),Z=(o(29132),o(84792)),F=o(26584),j=o(63290),P=o(75327),b=o(10699),C=o(21726),g=o(56741),v=o(15994),E=o(37053),w=o(46367),x=o(66385),Y=o(88071),k=o(82708),H=o(82959),X=o(38330);const _=/^\s*"([\S\s]*)"\s*$/,ee=/""/g,te=[","," ",";","|","\t"];function*G(s,n,e){let t=0;for(;t<=s.length;){const i=s.indexOf(n,t),r=s.substring(t,i>-1?i:void 0);t+=r.length+n.length,e&&!r.trim()||(yield r)}}function A(s){const n=s.includes("\r\n")?"\r\n":"\n";return G(s,n,!0)}function ne(s,n){return G(s,n,!1)}function*V(s,n,e,t=(()=>Object.create(null))){let i="",r="",a=0,d=t(),f=0;e:for(const l of s){const c=ne(l,e);for(const p of c)if(i+=r+p,r="",a+=re(p),a%2==0){if(a>0){const T=_.exec(i);if(!T){d=t(),f=0,i="",a=0;continue e}d[n[f]]=T[1].replace(ee,'"'),f++}else d[n[f]]=i,f++;i="",a=0}else r=e;0===a?(yield d,d=t(),f=0):r="\n"}}function re(s){let n=0,e=0;for(e=s.indexOf('"',e);e>=0;)n++,e=s.indexOf('"',e+1);return n}var L=o(56554),se=o(60466),oe=o(36630),le=o(65234);const ae=(0,L.bU)("esriGeometryPoint"),ue=["csv"],de=[0,0];class ce{constructor(n,e){this.x=n,this.y=e}}class fe{constructor(){var n=this;this._queryEngine=null,this._snapshotFeatures=function(){var e=(0,y.Z)(function*(t){const i=yield n._fetch(t);return n._createFeatures(i)});return function(t){return e.apply(this,arguments)}}()}destroy(){var n;null==(n=this._queryEngine)||n.destroy(),this._queryEngine=null}load(n,e={}){var t=this;return(0,y.Z)(function*(){var i;t.loadOptions=n;const[r]=yield Promise.all([t._fetch(e.signal),t._checkProjection(null==n||null==(i=n.parsingOptions)?void 0:i.spatialReference)]),a=function pe(s,n){const e=n.parsingOptions||{},t={delimiter:e.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:e.latitudeField,longitudeFieldName:e.longitudeField}},i=A(s);let r=i.next().value;if(!r)throw new F.Z("csv-layer:empty-csv","CSV is empty",{csv:s});if(r=r.trim(),!e.delimiter){const l=function ie(s){const n=s.trim();let e=0,t="";for(const i of te){const r=n.split(i).length;r>e&&(e=r,t=i)}return""===t?null:t}(r);if(!l)throw new F.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV");t.delimiter=l}const a=r.split(t.delimiter).filter(l=>!!l),d=t.layerDefinition={name:(0,C.vt)(n.url,ue)||"csv",drawingInfo:ae,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:e.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:e.spatialReference||{wkid:102100}}};if(!e.latitudeField||!e.longitudeField){const l=Q(a);if(!e.longitudeField&&!l.longitudeFieldName||!e.latitudeField&&!l.latitudeFieldName)throw new F.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file");t.locationInfo={longitudeFieldName:e.longitudeField||l.longitudeFieldName,latitudeFieldName:e.latitudeField||l.latitudeFieldName}}const f=B(i,t.delimiter,a,t.locationInfo);if(e.fields&&e.fields.length){const l=new Map;for(const c of e.fields)l.set(c.name.toLowerCase(),c);for(const c of f){const p=l.get(c.name.toLowerCase());if(p){const T=c.name;Object.assign(c,p),c.name=T}}}if(d.fields=f,!d.fields.some(l=>"esriFieldTypeOID"===l.type&&(d.objectIdField=l.name,!0))){const l={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};d.objectIdField=l.name,d.fields.unshift(l)}if(d.timeInfo){const l=new se.Z(d.fields),c=d.timeInfo;if(c.startTimeField){const p=l.get(c.startTimeField);p?(c.startTimeField=p.name,p.type="esriFieldTypeDate"):c.startTimeField=null}if(c.endTimeField){const p=l.get(c.endTimeField);p?(c.endTimeField=p.name,p.type="esriFieldTypeDate"):c.endTimeField=null}if(c.trackIdField){const p=l.get(c.trackIdField);c.trackIdField=p?p.name:null}c.startTimeField||c.endTimeField||(d.timeInfo=null)}return t}(r,n);t.locationInfo=a.locationInfo,t.delimiter=a.delimiter,t._queryEngine=t._createQueryEngine(a);const d=yield t._createFeatures(r);if(t._queryEngine.featureStore.addMany(d),a.layerDefinition.extent=t._queryEngine.fullExtent,a.layerDefinition.timeInfo){const{start:f,end:l}=t._queryEngine.timeExtent;a.layerDefinition.timeInfo.timeExtent=[f,l]}return a})()}applyEdits(){return(0,y.Z)(function*(){throw new F.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(n={},e={}){var t=this;return(0,y.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQuery(n,e.signal)})()}queryFeatureCount(n={},e={}){var t=this;return(0,y.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForCount(n,e.signal)})()}queryObjectIds(n={},e={}){var t=this;return(0,y.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForIds(n,e.signal)})()}queryExtent(n={},e={}){var t=this;return(0,y.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForExtent(n,e.signal)})()}querySnapping(n,e={}){var t=this;return(0,y.Z)(function*(){return yield t._waitSnapshotComplete(),t._queryEngine.executeQueryForSnapping(n,e.signal)})()}refresh(n){var e=this;return(0,y.Z)(function*(){var t;return e.loadOptions.customParameters=n,null==(t=e._snapshotTask)||t.abort(),e._snapshotTask=(0,b.vr)(e._snapshotFeatures),e._snapshotTask.promise.then(i=>{e._queryEngine.featureStore.clear(),i&&e._queryEngine.featureStore.addMany(i)},i=>{e._queryEngine.featureStore.clear(),(0,b.D_)(i)||j.Z.getLogger("esri.layers.CSVLayer").error(new F.Z("csv-layer:refresh","An error occurred during refresh",{error:i}))}),yield e._waitSnapshotComplete(),{extent:e._queryEngine.fullExtent,timeExtent:e._queryEngine.timeExtent}})()}_waitSnapshotComplete(){var n=this;return(0,y.Z)(function*(){if(n._snapshotTask&&!n._snapshotTask.finished){try{yield n._snapshotTask.promise}catch(e){}return n._waitSnapshotComplete()}})()}_fetch(n){var e=this;return(0,y.Z)(function*(){const{url:t,customParameters:i}=e.loadOptions;if(!t)throw new F.Z("csv-layer:invalid-source","url not defined");const r=(0,C.mN)(t);return(yield(0,Z.default)(r.path,{query:D(D({},r.query),i),responseType:"text",signal:n})).data})()}_createQueryEngine(n){const{objectIdField:e,fields:t,extent:i,timeInfo:r}=n.layerDefinition,a=new k.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new X.Z({fields:t,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:r,objectIdField:e,spatialReference:i.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:a})}_createFeatures(n){var e=this;return(0,y.Z)(function*(){const{latitudeFieldName:t,longitudeFieldName:i}=e.locationInfo,{objectIdField:r,fieldsIndex:a,spatialReference:d}=e._queryEngine;let f=[];const l=[],c=a.fields.filter(u=>u.name!==r).map(u=>u.name);let p=0;const T=A(n);T.next();const q={};for(const u of a.fields)if("esriFieldTypeOID"!==u.type&&"esriFieldTypeGlobalID"!==u.type){const N=(0,oe.os)(u);void 0!==N&&(q[u.name]=N)}const Fe=V(T,c,e.delimiter,(0,L.Dm)(q,r));for(const u of Fe){const N=e._parseCoordinateValue(u[t]),S=e._parseCoordinateValue(u[i]);if(null!=S&&null!=N&&!isNaN(N)&&!isNaN(S)){u[t]=N,u[i]=S;for(const h in u)if(h!==t&&h!==i)if(a.isDateField(h)){const O=new Date(u[h]);u[h]=W(O,u[h])?O.getTime():null}else if(a.isNumericField(h)){const O=M(u[h]);u[h]=isNaN(O)?null:O}u[r]=p,p++,f.push(new ce(S,N)),l.push(u)}}if(!(0,E.fS)({wkid:4326},d))if((0,E.sS)(d))for(const u of f)[u.x,u.y]=(0,w.hG)(u.x,u.y,de);else f=(0,g.oj)(v.N,f,le.Z.WGS84,d,null);const z=[];for(let u=0;u<f.length;u++){const{x:N,y:S}=f[u],h=l[u];h[r]=u+1,z.push(new x.ZP(new Y.Z([],[N,S]),h,null,h[r]))}return z})()}_parseCoordinateValue(n){if(null==n||""===n)return null;let e=M(n);return(isNaN(e)||Math.abs(e)>181)&&(e=parseFloat(n)),e}_checkProjection(n){return(0,y.Z)(function*(){try{yield(0,H._W)(E.Zn,n)}catch(e){throw new F.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}const me=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point-y"],ye=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point-x"];function Q(s){const n=s.map(e=>e.toLowerCase());return{longitudeFieldName:s[n.indexOf(ye.find(e=>n.includes(e)))],latitudeFieldName:s[n.indexOf(me.find(e=>n.includes(e)))]}}function B(s,n,e,t){const i=[],r=V(s,e,n),a=[];for(const d of r){if(10===a.length)break;a.push(d)}for(const d of e)if(d===t.longitudeFieldName||d===t.latitudeFieldName)i.push({name:d,type:"esriFieldTypeDouble",alias:d});else{const f=$(a.map(c=>c[d])),l={name:d,type:null,alias:d};switch(f){case"integer":l.type="esriFieldTypeInteger";break;case"double":l.type="esriFieldTypeDouble";break;case"date":l.type="esriFieldTypeDate",l.length=36;break;default:l.type="esriFieldTypeString",l.length=255}i.push(l)}return i}function $(s){if(!s.length)return"string";const n=/[^+-.,0-9]/;return s.map(e=>{let t=!1;if(""!==e){if(n.test(e))t=!0;else{let i=M(e);if(!isNaN(i))return/[.,]/.test(e)||!Number.isInteger(i)||i>214783647||i<-214783648?"double":"integer";if(-1===e.indexOf("E"))t=!0;else{if(i=Number(e),!isNaN(i))return"double";if(-1===e.indexOf(","))t=!0;else{if(e=e.replace(",","."),i=Number(e),!isNaN(i))return"double";t=!0}}}return t?/^[-]?\d*[.,]?\d*$/.test(e)?"string":W(new Date(e),e)?"date":"string":"string"}}).reduce((e,t)=>void 0===e||e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0)}const ge=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,he=Number.isNaN(new Date("technology 10").getTime());function W(s,n){if(!s||"[object Date]"!==Object.prototype.toString.call(s)||isNaN(s.getTime()))return!1;let e=!0;if(!he&&/\d+\W*$/.test(n)){const t=n.match(/[a-zA-Z]{2,}/);if(t){let i=!1,r=0;for(;!i&&r<=t.length;)i=!ge.test(t[r]),r++;e=!i}}return e}const M=function(){const s=(0,P.lt)(),n=new RegExp("^"+s.regexp+"$"),e=new RegExp("["+s.group+"\\s\\xa0]","g"),t=s.factor;return function(i){const r=n.exec(i);if(s.factor=t,!r)return NaN;let a=r[1];if(!r[1]){if(!r[2])return NaN;a=r[2],s.factor*=-1}return a=a.replace(e,"").replace(s.decimal,"."),+a*s.factor}}()},56554:(I,m,o)=>{o.d(m,{MS:()=>C,Dm:()=>P,Hq:()=>b,bU:()=>j});var y=o(8314),R=o(58817),Z=o(87757),F=o(24837);function j(g){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===g||"esriGeometryMultipoint"===g?F.I4:"esriGeometryPolyline"===g?F.ET:F.lF}}}function P(g,v){if((0,y.Z)("esri-csp-restrictions"))return()=>D({[v]:null},g);try{let E=`this.${v} = null;`;for(const x in g)E+=`this${x.includes(".")?`["${x}"]`:`.${x}`} = ${JSON.stringify(g[x])};`;const w=new Function(E);return()=>new w}catch(E){return()=>D({[v]:null},g)}}function b(g={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,R.d9)(g)}}]}function C(g,v){return{attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:g},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:v,supportsDelete:v,supportsEditing:v,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:v,supportsExceedsLimitStatistics:!0},query:Z.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0},editing:{supportsGeometryUpdate:v,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);