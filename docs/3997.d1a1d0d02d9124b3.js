"use strict";var Ue=Object.defineProperty,Le=Object.defineProperties,je=Object.getOwnPropertyDescriptors,ge=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,Ae=Object.prototype.propertyIsEnumerable,he=(Y,j,f)=>j in Y?Ue(Y,j,{enumerable:!0,configurable:!0,writable:!0,value:f}):Y[j]=f,A=(Y,j)=>{for(var f in j||(j={}))Be.call(j,f)&&he(Y,f,j[f]);if(ge)for(var f of ge(j))Ae.call(j,f)&&he(Y,f,j[f]);return Y},G=(Y,j)=>Le(Y,je(j));(self.webpackChunksite=self.webpackChunksite||[]).push([[3997],{50011:(Y,j,f)=>{f.d(j,{F:()=>z,M:()=>W});const W={Base64:0,Hex:1,String:2,Raw:3};function Z(s,u){const n=(65535&s)+(65535&u);return(s>>16)+(u>>16)+(n>>16)<<16|65535&n}function U(s,u,n,t,l,a){return Z(function w(s,u){return s<<u|s>>>32-u}(Z(Z(u,s),Z(t,a)),l),n)}function P(s,u,n,t,l,a,o){return U(u&n|~u&t,s,u,l,a,o)}function T(s,u,n,t,l,a,o){return U(u&t|n&~t,s,u,l,a,o)}function F(s,u,n,t,l,a,o){return U(u^n^t,s,u,l,a,o)}function y(s,u,n,t,l,a,o){return U(n^(u|~t),s,u,l,a,o)}function z(s,u=W.Hex){const n=u||W.Base64,t=function E(s,u){s[u>>5]|=128<<u%32,s[14+(u+64>>>9<<4)]=u;let n=1732584193,t=-271733879,l=-1732584194,a=271733878;for(let o=0;o<s.length;o+=16){const L=n,p=t,g=l,O=a;n=P(n,t,l,a,s[o+0],7,-680876936),a=P(a,n,t,l,s[o+1],12,-389564586),l=P(l,a,n,t,s[o+2],17,606105819),t=P(t,l,a,n,s[o+3],22,-1044525330),n=P(n,t,l,a,s[o+4],7,-176418897),a=P(a,n,t,l,s[o+5],12,1200080426),l=P(l,a,n,t,s[o+6],17,-1473231341),t=P(t,l,a,n,s[o+7],22,-45705983),n=P(n,t,l,a,s[o+8],7,1770035416),a=P(a,n,t,l,s[o+9],12,-1958414417),l=P(l,a,n,t,s[o+10],17,-42063),t=P(t,l,a,n,s[o+11],22,-1990404162),n=P(n,t,l,a,s[o+12],7,1804603682),a=P(a,n,t,l,s[o+13],12,-40341101),l=P(l,a,n,t,s[o+14],17,-1502002290),t=P(t,l,a,n,s[o+15],22,1236535329),n=T(n,t,l,a,s[o+1],5,-165796510),a=T(a,n,t,l,s[o+6],9,-1069501632),l=T(l,a,n,t,s[o+11],14,643717713),t=T(t,l,a,n,s[o+0],20,-373897302),n=T(n,t,l,a,s[o+5],5,-701558691),a=T(a,n,t,l,s[o+10],9,38016083),l=T(l,a,n,t,s[o+15],14,-660478335),t=T(t,l,a,n,s[o+4],20,-405537848),n=T(n,t,l,a,s[o+9],5,568446438),a=T(a,n,t,l,s[o+14],9,-1019803690),l=T(l,a,n,t,s[o+3],14,-187363961),t=T(t,l,a,n,s[o+8],20,1163531501),n=T(n,t,l,a,s[o+13],5,-1444681467),a=T(a,n,t,l,s[o+2],9,-51403784),l=T(l,a,n,t,s[o+7],14,1735328473),t=T(t,l,a,n,s[o+12],20,-1926607734),n=F(n,t,l,a,s[o+5],4,-378558),a=F(a,n,t,l,s[o+8],11,-2022574463),l=F(l,a,n,t,s[o+11],16,1839030562),t=F(t,l,a,n,s[o+14],23,-35309556),n=F(n,t,l,a,s[o+1],4,-1530992060),a=F(a,n,t,l,s[o+4],11,1272893353),l=F(l,a,n,t,s[o+7],16,-155497632),t=F(t,l,a,n,s[o+10],23,-1094730640),n=F(n,t,l,a,s[o+13],4,681279174),a=F(a,n,t,l,s[o+0],11,-358537222),l=F(l,a,n,t,s[o+3],16,-722521979),t=F(t,l,a,n,s[o+6],23,76029189),n=F(n,t,l,a,s[o+9],4,-640364487),a=F(a,n,t,l,s[o+12],11,-421815835),l=F(l,a,n,t,s[o+15],16,530742520),t=F(t,l,a,n,s[o+2],23,-995338651),n=y(n,t,l,a,s[o+0],6,-198630844),a=y(a,n,t,l,s[o+7],10,1126891415),l=y(l,a,n,t,s[o+14],15,-1416354905),t=y(t,l,a,n,s[o+5],21,-57434055),n=y(n,t,l,a,s[o+12],6,1700485571),a=y(a,n,t,l,s[o+3],10,-1894986606),l=y(l,a,n,t,s[o+10],15,-1051523),t=y(t,l,a,n,s[o+1],21,-2054922799),n=y(n,t,l,a,s[o+8],6,1873313359),a=y(a,n,t,l,s[o+15],10,-30611744),l=y(l,a,n,t,s[o+6],15,-1560198380),t=y(t,l,a,n,s[o+13],21,1309151649),n=y(n,t,l,a,s[o+4],6,-145523070),a=y(a,n,t,l,s[o+11],10,-1120210379),l=y(l,a,n,t,s[o+2],15,718787259),t=y(t,l,a,n,s[o+9],21,-343485551),n=Z(n,L),t=Z(t,p),l=Z(l,g),a=Z(a,O)}return[n,t,l,a]}(function X(s){const u=[];for(let n=0,t=8*s.length;n<t;n+=8)u[n>>5]|=(255&s.charCodeAt(n/8))<<n%32;return u}(s),8*s.length);switch(n){case W.Raw:return t;case W.Hex:return function J(s){const u="0123456789abcdef",n=[];for(let t=0,l=4*s.length;t<l;t++)n.push(u.charAt(s[t>>2]>>t%4*8+4&15)+u.charAt(s[t>>2]>>t%4*8&15));return n.join("")}(t);case W.String:return function H(s){const u=[];for(let n=0,t=32*s.length;n<t;n+=8)u.push(String.fromCharCode(s[n>>5]>>>n%32&255));return u.join("")}(t);case W.Base64:return function $(s){const t=[];for(let l=0,a=4*s.length;l<a;l+=3){const o=(s[l>>2]>>l%4*8&255)<<16|(s[l+1>>2]>>(l+1)%4*8&255)<<8|s[l+2>>2]>>(l+2)%4*8&255;for(let L=0;L<4;L++)t.push(8*l+6*L>32*s.length?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(o>>6*(3-L)&63))}return t.join("")}(t)}}},23997:(Y,j,f)=>{f.r(j),f.d(j,{addAggregateFields:()=>pe,createMatcherSchema:()=>se,createSchema:()=>Se,createSymbolSchema:()=>h,createSymbolSchemaOptions:()=>S}),f(4832),f(49067),f(26284),f(54928),f(69357);var H=f(40342),w=(f(14726),f(33474),f(26584)),U=f(8314),P=f(58817),T=f(63290),F=f(62208),y=f(23841),E=f(65270),z=f(39406),s=f(64288),u=f(18716),n=f(25310),l=f(44316),a=f(22418),o=f(62192),L=f(43930);const p=T.Z.getLogger("esri.views.2d.layers.features.schemaUtils"),g="ValidationError",O={esriGeometryPoint:["above-right","above-center","above-left","center-center","center-left","center-right","below-center","below-left","below-right"],esriGeometryPolygon:["always-horizontal"],esriGeometryPolyline:["center-along"],esriGeometryMultipoint:null};function d(e){return(0,u.hF)(e)}function v(e){var r;return"line-marker"===e.type?{type:"line-marker",color:null==(r=e.color)?void 0:r.toJSON(),placement:e.placement,style:e.style}:(0,E.i)(e.toJSON()).toJSON()}function S(e){let r=0,i=0,c=!1,m=!0,x=!0;if((0,F.pC)(e)&&(i=(0,l.J)(e),"visualVariables"in e&&(r=function t(e){if(!e)return z.X.NONE;let r=0;for(const i of e)if("size"===i.type){const c=(0,n.a)(i);r|=c,"outline"===i.target&&(r|=c<<4)}else"color"===i.type?r|=z.X.COLOR:"opacity"===i.type?r|=z.X.OPACITY:"rotation"===i.type&&(r|=z.X.ROTATION);return r}(e.visualVariables||[]),c="dot-density"===e.type),!c)){const I=e.getSymbols();"backgroundFillSymbol"in e&&e.backgroundFillSymbol&&I.push(e.backgroundFillSymbol);for(const V of I)if("cim"===V.type&&(m=!1),"simple-fill"===V.type||"picture-fill"===V.type){const R=V.outline;R&&"none"!==R.style&&"solid"!==R.style&&(x=!1);const C=R&&"none"!==R.style&&"solid"!==R.style,B="simple-fill"===V.type&&"none"!==V.style&&"solid"!==V.style;("picture-fill"===V.type||B||C)&&(m=!1)}}return c&&(x=!1),{vvFlags:r,maxVVSize:i,supportsOutlineFills:x,stride:{fill:c?"dot-density":m?"simple":"default"}}}function h(e,r,i){return M(e,S(r),i)}function M(e,r,i){if(!e)return null;switch(e.type){case"simple-fill":case"picture-fill":return function ee(e,r,i){const c=r.supportsOutlineFills,m=(0,u.jj)(z.LW.FILL,G(A({},r),{isOutlinedFill:c})),x=i?d(m):m,I=e.clone(),V=I.outline;r.supportsOutlineFills||(I.outline=null);const R=A({materialKey:x,hash:I.hash(),isOutlinedFill:!!r.supportsOutlineFills},v(I));if(r.supportsOutlineFills)return R;const C=[];if(C.push(R),V){const B=(0,u.jj)(z.LW.LINE,G(A({},r),{isOutline:!0})),Q=A({materialKey:i?d(B):B,hash:V.hash()},v(V));C.push(Q)}return{type:"composite-symbol",layers:C,hash:C.reduce((B,Q)=>Q.hash+B,"")}}(e,r,i);case"simple-marker":case"picture-marker":return function ve(e,r,i){const c=(0,u.jj)(z.LW.MARKER,r),m=i?d(c):c,x=v(e);return G(A({materialKey:m,hash:e.hash()},x),{angle:e.angle,maxVVSize:r.maxVVSize})}(e,r,i);case"simple-line":return function D(e,r,i){const c=(0,u.jj)(z.LW.LINE,r),m=i?d(c):c,x=e.clone(),I=x.marker;x.marker=null;const V=[];if(V.push(A({materialKey:m,hash:x.hash()},v(x))),I){var R;const C=(0,u.jj)(z.LW.MARKER,r),B=i?d(C):C;I.color=null!=(R=I.color)?R:x.color,V.push(A({materialKey:B,hash:I.hash(),lineWidth:x.width},v(I)))}return{type:"composite-symbol",layers:V,hash:V.reduce((C,B)=>B.hash+C,"")}}(e,r,i);case"text":return function xe(e,r,i){const c=(0,u.jj)(z.LW.TEXT,r),m=i?d(c):c,x=v(e);return G(A({materialKey:m,hash:e.hash()},x),{angle:e.angle,maxVVSize:r.maxVVSize})}(e,r,i);case"label":return function Ee(e,r,i){const c=e.toJSON(),m=(0,u.jj)(z.LW.LABEL,G(A({},r),{placement:c.labelPlacement}));return G(A({materialKey:i?d(m):m,hash:e.hash()},c),{labelPlacement:c.labelPlacement})}(e,r,i);case"cim":return{type:"cim",rendererKey:r.vvFlags,data:e.data,maxVVSize:r.maxVVSize};case"CIMSymbolReference":return{type:"cim",rendererKey:r.vvFlags,data:e,maxVVSize:r.maxVVSize};case"web-style":return G(A({},v(e)),{type:"web-style",hash:e.hash(),rendererKey:r.vvFlags,maxVVSize:r.maxVVSize});default:throw new Error(`symbol not supported ${e.type}`)}}function oe(e,r){const i=(0,P.d9)(e);return i.some(c=>function be(e,r){const i=e.labelPlacement,c=O[r];if(!e.symbol)return p.warn("No ILabelClass symbol specified."),!0;if(!c)return p.error(new w.Z("mapview-labeling:unsupported-geometry-type",`Unable to create labels for Feature Layer, ${r} is not supported`)),!0;if(!c.some(m=>m===i)){const m=c[0];i&&p.warn(`Found invalid label placement type ${i} for ${r}. Defaulting to ${m}`),e.labelPlacement=m}return!1}(c,r))?[]:i}function Se(e){return(0,U.Z)("esri-2d-update-debug")&&console.debug("Created new schema",ue(e,!0)),ue(e)}function ue(e,r=!1){try{var i,c;const m=function Ve(e,r=!1){const i=new Array;return i.push(function Fe(e,r,i=!1){const c={indexCount:0,fields:{}},m="featureReduction"in e&&e.featureReduction,x=m?"aggregate":"feature";if("sublayers"in e){const I={type:"subtype",subtypeField:e.subtypeField,renderers:{},stride:{fill:"default"}},V={type:"subtype",mapping:{},target:"feature"},R={type:"subtype",classes:{}},C={type:"symbol",target:"feature",aggregateFields:[],attributes:c,storage:V,mesh:{matcher:I,aggregateMatcher:null,labels:R,sortKey:null}},B=new Set;let Q=0;for(const{renderer:_,subtypeCode:k,labelingInfo:le,labelsVisible:ae}of e.sublayers){const ie=se(c,x,_,i),q=me(c,x,_),ye=ae&&le;if("visualVariables"in _&&_.visualVariables&&_.visualVariables.length)throw new w.Z(g,"Visual variables are currently not supported for subtype layers");if("dictionary"===ie.type)throw new w.Z(g,"Dictionary renderer is not supported in subtype layers");if("subtype"===ie.type)throw new w.Z(g,"Nested subtype renderers is not supported");if((0,F.pC)(q)&&"subtype"===q.type)throw new w.Z(g,"Nested subtype storage is not supported");if((0,F.pC)(q)&&"dot-density"===q.type)throw new w.Z(g,"Dot density attributes are not supported in subtype layers");if(B.has(k))throw new w.Z(g,"Subtype codes for sublayers must be unique");B.add(k),I.renderers[k]=ie,V.mapping[k]=q,ye&&(R.classes[k]=ye.map(De=>re(_,c,De,"feature",Q++,i)))}return C}if("heatmap"===e.renderer.type){const{blurRadius:I,fieldOffset:V,field:R}=e.renderer;return{type:"heatmap",aggregateFields:[],attributes:c,target:x,storage:null,mesh:{blurRadius:I,fieldOffset:V,field:te(c,{target:x,field:R,resultType:"numeric"}).field}}}{const I=[],V="aggregate"===x?(0,o.S1)(I,e.renderer,m,null):e.renderer;pe(c,I);const R=se(c,x,V,i);let C=null;const B=me(c,x,V),Q=(0,L.oq)(e.geometryType);let _=e.labelsVisible&&e.labelingInfo||[],k=[];if(m){if("selection"===m.type)throw new w.Z(g,"Mapview does not support `selection` reduction type",m);if(m.symbol){const q=new H.Z({symbol:m.symbol,visualVariables:"visualVariables"in V?V.visualVariables:null});C=se(c,x,q,i)}k=m&&m.labelsVisible&&m.labelingInfo||[]}_=oe(_,Q),k=oe(k,Q);let le=0;const ae=[..._.map(q=>re(V,c,q,"feature",le++,i)),...k.map(q=>re(V,c,q,"aggregate",le++,i))],ie=function Oe(e,r){if((0,F.Wi)(r)||!r.length)return null;r.length>1&&p.warn(`Layer rendering currently only supports ordering by 1 orderByInfo, but found ${r.length}. All but the first will be discarded`);const i=r[0],c="ascending"===i.order?"asc":"desc";return i.field?{field:i.field,order:c}:i.valueExpression?{fieldIndex:ne(e,{type:"expression",target:"feature",valueExpression:i.valueExpression,resultType:"numeric"}).fieldIndex,order:c}:(p.error(new w.Z(g,"Expected to find a field or valueExpression for OrderByInfo",i)),null)}(c,e.orderBy);return{type:"symbol",target:x,attributes:c,aggregateFields:I,storage:B,mesh:{matcher:R,labels:{type:"simple",classes:ae},aggregateMatcher:C,sortKey:ie}}}}(e)),i}(e,r),x={};return m.map(I=>function Me(e,r,i){switch(i.target){case"feature":return void fe(e,de(r),i);case"aggregate":{if(!("featureReduction"in r))return;const c=r.featureReduction;if("selection"===c.type)throw new w.Z(g,"Mapview does not support `selection` reduction type",c);return fe(e,de(r),i),void function ze(e,r,i){e.aggregate||(e.aggregate={name:"aggregate",input:"feature",filters:null,attributes:{},params:{clusterRadius:(0,y.F2)(r.clusterRadius/2),clusterPixelBuffer:64*Math.ceil((0,y.F2)(r.clusterMaxSize)/64),fields:i.aggregateFields}}),ce(e.aggregate,i.attributes.fields)}(e,c,i)}}}(x,e,I)),{source:{definitionExpression:e.definitionExpression,fields:e.fields.map(I=>I.toJSON()),gdbVersion:e.gdbVersion,historicMoment:null==(i=e.historicMoment)?void 0:i.getTime(),outFields:e.availableFields,pixelBuffer:e.pixelBuffer,spatialReference:e.spatialReference.toJSON(),timeExtent:null==(c=e.timeExtent)?void 0:c.toJSON(),customParameters:e.customParameters},attributes:{fields:{},indexCount:0},processors:m,targets:x}}catch(m){if(m.fieldName===g)return p.error(m),null;throw m}}function ce(e,r){for(const i in r){const c=r[i];if(c.target!==e.name)continue;const m=e.attributes[i];m?(m.context.mesh=m.context.mesh||c.context.mesh,m.context.storage=m.context.storage||c.context.storage):e.attributes[i]=c}return e}function de(e){var r,i,c,m,x;return[null!=(r=null==(i=(0,F.Wg)(e.filter))?void 0:i.toJSON())?r:null,null!=(c=null==(m=(0,F.Wg)(null==(x=(0,F.Wg)(e.featureEffect))?void 0:x.filter))?void 0:m.toJSON())?c:null]}function fe(e,r,i){return e.feature||(e.feature={name:"feature",input:"source",filters:r,attributes:{}}),ce(e.feature,i.attributes.fields),e}function te(e,r){return r.field?ne(e,G(A({},r),{type:"field",field:r.field})):r.valueExpression?ne(e,G(A({},r),{type:"expression",valueExpression:r.valueExpression})):{field:null,fieldIndex:null}}function ne(e,r){switch(r.type){case"expression":{const i=r.valueExpression;if(!e.fields[i]){const c=e.indexCount++;e.fields[i]=G(A({},r),{name:i,fieldIndex:c})}return{fieldIndex:e.fields[i].fieldIndex}}case"label-expression":{const i=JSON.stringify(r.label);if(!e.fields[i]){const c=e.indexCount++;e.fields[i]=G(A({},r),{name:i,fieldIndex:c})}return{fieldIndex:e.fields[i].fieldIndex}}case"field":{const i=r.field;return"aggregate"===r.target&&e.fields[i]||(e.fields[i]=G(A({},r),{name:i})),{field:i}}case"statistic":return e.fields[r.name]=A({},r),{field:r.name}}}function re(e,r,i,c,m,x=!1){const I=ne(r,{type:"label-expression",target:c,context:{mesh:!0},resultType:"string",label:{labelExpression:i.labelExpression,labelExpressionInfo:i.labelExpressionInfo?{expression:i.labelExpressionInfo.expression}:null,symbol:!!i.symbol,where:i.where}}),{fieldIndex:V}=I;return G(A({},h(i,e,x)),{fieldIndex:V,target:c,index:m})}function pe(e,r){const i={mesh:!0,storage:!0};for(const c of r){const{name:m,outStatistic:x}=c,{statisticType:I,onStatisticField:V}=x;let R=null,C=null,B=null;const Q="numeric",_="feature";"onStatisticValueExpression"in x?C=ne(e,{type:"expression",target:_,valueExpression:x.onStatisticValueExpression,resultType:Q}).fieldIndex:"onStatisticNormalizationField"in x?(R=ne(e,{type:"field",target:_,field:V,resultType:Q}).field,B=x.onStatisticNormalizationField):R=ne(e,{type:"field",target:_,field:V,resultType:Q}).field,ne(e,{type:"statistic",target:"aggregate",name:m,context:i,inField:R,inNormalizationField:B,inFieldIndex:C,statisticType:I})}}function me(e,r,i){switch(i.type){case"dot-density":return function Ie(e,r,i){return i&&i.length?{type:"dot-density",mapping:i.map((c,m)=>{const{field:x,fieldIndex:I}=te(e,{valueExpression:c.valueExpression,field:c.field,resultType:"numeric",target:r});return{binding:m,field:x,fieldIndex:I}}),target:r}:{type:"dot-density",mapping:[],target:r}}(e,r,i.attributes);case"simple":case"class-breaks":case"unique-value":case"dictionary":return function Te(e,r,i){if(!i||!i.length)return{type:"visual-variable",mapping:[],target:r};const c={storage:!0},m="numeric";return{type:"visual-variable",mapping:(0,a.t)(i).map(x=>{var I;const V=(0,s.nU)(x.type),{field:R,fieldIndex:C}=te(e,{target:r,valueExpression:x.valueExpression,field:x.field,context:c,resultType:m});switch(x.type){case"size":return"$view.scale"===x.valueExpression?null:{type:"size",binding:V,field:R,fieldIndex:C,normalizationField:te(e,{target:r,field:x.normalizationField,context:c,resultType:m}).field,valueRepresentation:null!=(I=x.valueRepresentation)?I:null};case"color":return{type:"color",binding:V,field:R,fieldIndex:C,normalizationField:te(e,{target:r,field:x.normalizationField,context:c,resultType:m}).field};case"opacity":return{type:"opacity",binding:V,field:R,fieldIndex:C,normalizationField:te(e,{target:r,field:x.normalizationField,context:c,resultType:m}).field};case"rotation":return{type:"rotation",binding:V,field:R,fieldIndex:C}}}).filter(x=>x),target:r}}(e,r,i.visualVariables);case"heatmap":return null}}function se(e,r,i,c=!1){const m=(0,F.Pt)(e,{indexCount:0,fields:{}});switch(i.type){case"simple":case"dot-density":return function Re(e,r,i=!1){const c=r.getSymbols(),m=c.length?c[0]:null,{stride:x}=S(r);return{type:"simple",symbol:h(m,r,i),stride:x}}(0,i,c);case"class-breaks":return function Pe(e,r,i,c=!1){const x=i.backgroundFillSymbol,{field:I,fieldIndex:V}=te(e,{target:r,field:i.field,valueExpression:i.valueExpression,resultType:"numeric",context:{mesh:!0,use:"renderer.field"}}),R=i.normalizationType,C="log"===R?"esriNormalizeByLog":"percent-of-total"===R?"esriNormalizeByPercentOfTotal":"field"===R?"esriNormalizeByField":null,B=S(i),Q=i.classBreakInfos.map(_=>({symbol:M(_.symbol,B,c),min:_.minValue,max:_.maxValue})).sort((_,k)=>_.min-k.min);return{type:"interval",attributes:e.fields,field:I,fieldIndex:V,backgroundFillSymbol:M(x,B,c),defaultSymbol:M(i.defaultSymbol,B,c),intervals:Q,normalizationField:i.normalizationField,normalizationTotal:i.normalizationTotal,normalizationType:C,isMaxInclusive:i.isMaxInclusive,stride:B.stride}}(m,r,i,c);case"unique-value":return function we(e,r,i,c=!1){const m=[],x=i.backgroundFillSymbol,I={target:r,context:{mesh:!0},resultType:"string"};if(i.field&&"string"!=typeof i.field)throw new w.Z(g,"Expected renderer.field to be a string",i);const{field:V,fieldIndex:R}=te(e,G(A({},I),{field:i.field,valueExpression:i.valueExpression})),C=S(i);for(const B of i.uniqueValueInfos)m.push({value:""+B.value,symbol:M(B.symbol,C,c)});return{type:"map",attributes:e.fields,field:V,fieldIndex:R,field2:te(e,G(A({},I),{field:i.field2})).field,field3:te(e,G(A({},I),{field:i.field3})).field,fieldDelimiter:i.fieldDelimiter,backgroundFillSymbol:M(x,C),defaultSymbol:M(i.defaultSymbol,C),map:m,stride:C.stride}}(m,r,i,c);case"dictionary":return function Ce(e,r,i=!1){return{type:"dictionary",renderer:r.toJSON(),stride:{fill:"default"}}}(0,i,c)}}},44316:(Y,j,f)=>{f.d(j,{G:()=>T,J:()=>U});var W=f(15861),N=f(23841),K=f(35909),Z=f(31375),X=f(39351),H=f(64596),J=f(11263);const $={"simple-marker":1,"picture-marker":1,text:0,"simple-line":0,"simple-fill":0,"picture-fill":0,cim:1,"web-style":1};function U(p){if(!("visualVariables"in p)||!p.hasVisualVariables("size"))return 0;const g=p.getVisualVariablesForType("size");if(!g[0])return 0;const O=g[0];if("outline"===O.target)return 0;if("stops"===O.transformationType)return O.stops.map(d=>d.size).reduce(L,0);if("clamped-linear"===O.transformationType){let d=-1/0,b=-1/0;return d="number"==typeof O.maxSize?O.maxSize:O.maxSize.stops.map(v=>v.size).reduce(L,0),b="number"==typeof O.minSize?O.minSize:O.minSize.stops.map(v=>v.size).reduce(L,0),Math.max(d,b)}return"real-world-size"===O.transformationType?30:void 0}function P(p){return p.type in $}function T(p,g,O,d,b,v){return F.apply(this,arguments)}function F(){return(F=(0,W.Z)(function*(p,g,O,d,b,v){if(!p||v&&"cluster"===v.type)return 0;if("heatmap"===p.type)return Math.round(3*p.blurRadius);if("dot-density"===p.type)return 0;if("dictionary"===p.type)return"esriGeometryPoint"===g||"esriGeometryMultipoint"===g?100:200;const S=p.getSymbols(),h=U(p),M=[];for(const D of S)M.push(l(D,h,O,g,d,b));const ee=yield Promise.all(M);return(0,N.F2)(ee.reduce(L,0))})).apply(this,arguments)}const y=[0,0,0,0];function E(p,g){return null==p?g:p}function z(p,g){return null==p.outline?g:E(p.outline.width,g)}const s={sdf:!0,code:99,metrics:X.eF.metrics,rect:new Z.Z(0,0,24,24),page:0,textureBinding:2};function u(p){const g=p.text&&p.text.length;if(!g)return{glyphMosaicItems:[s]};const O=[];for(let d=0;d<g;d++)O.push(G(A({},s),{code:p.text.charCodeAt(d)}));return{glyphMosaicItems:O}}function n(p,g,O,d,b,v){return t.apply(this,arguments)}function t(){return(t=(0,W.Z)(function*(p,g,O,d,b,v){if("simple-marker"===p.type){const S=Math.max(E(p.size,12),g);return o(p)+.707*S}if("picture-marker"===p.type){const S=Math.max(E(p.height,12),g),h=E(p.width,12)*(S/E(p.height,12))/2,M=S/2;return o(p)+Math.sqrt(h*h+M*M)}if("text"===p.type){const S=u(p);(0,H.Q2)(y,p.toJSON(),S);const h=Math.abs(y[0]),M=Math.abs(y[1]),ee=y[2],D=y[3];return Math.max(h,M)+Math.max(ee,D)}if("simple-line"===p.type){const S=p,h=Math.max(E(S.width,.75),g)/2;return S.marker?Math.max(6*S.width,2*g):h}if("simple-fill"===p.type||"picture-fill"===p.type)return Math.max(z(p,0),g)/2;if("cim"===p.type){const S={geometryType:d,fields:b,spatialReference:v},h={type:"cim",rendererKey:0,data:p.data,maxVVSize:g};yield(0,J.B3)(h,S,O);const M=K.B$.getEnvelope(p.data,O);return M?Math.sqrt(M.width*M.width+M.height*M.height):0}return"web-style"===p.type?n(yield p.fetchCIMSymbol(),g,O,d,b,v):0})).apply(this,arguments)}function l(p,g,O,d,b,v){return a.apply(this,arguments)}function a(){return(a=(0,W.Z)(function*(p,g,O,d,b,v){return P(p)?Math.min(yield n(p,g,O,d,b,v),75):0})).apply(this,arguments)}function o(p){const g=E(p.xoffset,0),O=E(p.yoffset,0);return Math.sqrt(g*g+O*O)}function L(p,g){return Math.max(p,g)}},22418:(Y,j,f)=>{f.d(j,{a:()=>H,t:()=>J});var W=f(63290),N=f(23841);const X=W.Z.getLogger("esri.renderers.visualVariables.support.utils"),H=y=>{if(!("visualVariables"in y)||!y.visualVariables||!y.visualVariables.length)return y;const E=y.clone(),z=E.visualVariables.map(s=>$(s)?w(s):s);return E.visualVariables=z,E};function J(y){return y.map(E=>$(E)?w(E.clone()):E)}function $(y){return("size"===y.type||"color"===y.type||"opacity"===y.type)&&null!=y.stops}function w(y){return y.stops=function F(y,E){return E.length<=8?E:(X.warn(`Found ${E.length} Visual Variable stops, but MapView only supports 8. Displayed stops will be simplified.`),E.length>16?function P(y,E){const[z,...s]=E,u=s.pop(),n=s[0].value,t=s[s.length-1].value,l=(t-n)/6,a=[];for(let o=n;o<t;o+=l){let L=0;for(;o>=s[L].value;)L++;const p=s[L],g=E[L-1],O=o-g.value,d=p.value===g.value?1:O/(p.value-g.value);if("color"===y){const b=s[L],v=E[L-1],S=b.color.clone();S.r=U(v.color.r,S.r,d),S.g=U(v.color.g,S.g,d),S.b=U(v.color.b,S.b,d),S.a=U(v.color.a,S.a,d),a.push({value:o,color:S,label:b.label})}else if("size"===y){const b=s[L],v=E[L-1],S=(0,N.t_)(b.size),h=U((0,N.t_)(v.size),S,d);a.push({value:o,size:h,label:b.label})}else{const b=s[L],v=U(E[L-1].opacity,b.opacity,d);a.push({value:o,opacity:v,label:b.label})}}return[z,...a,u]}(y,E):function T(y){const[E,...z]=y,s=z.pop();for(;z.length>6;){let u=0,n=0;for(let t=1;t<z.length;t++){const o=Math.abs(z[t].value-z[t-1].value);o>n&&(n=o,u=t)}z.splice(u,1)}return[E,...z,s]}(E))}(y.type,y.stops),y}function U(y,E,z){return(1-z)*y+z*E}},64596:(Y,j,f)=>{f.d(j,{y1:()=>P,I_:()=>U,Q2:()=>z,eT:()=>E,Zu:()=>T,yA:()=>y,ab:()=>F,XA:()=>s});var W=f(986),N=f(62208),K=f(23841),Z=f(37118),X=f(65401),H=f(74618),J=f(61261),$=f(39351),w=f(25797);const U=512,P=50;function T(u,n){if(!n.isWrappable)return null;const[t,l]=(0,H.uS)(n);return u[2]>l?[(0,X.Ue)([u[0],u[1],l,u[3]]),(0,X.Ue)([t,u[1],t+u[2]-l,u[3]])]:u[0]<t?[(0,X.Ue)([t,u[1],u[2],u[3]]),(0,X.Ue)([l-(t-u[0]),u[1],l,u[3]])]:null}function F(u){return"text"===u||"esriTS"===u}function y(u){return"simple-marker"===u||"picture-marker"===u||"esriSMS"===u||"esriPMS"===u}function E(u){switch((0,N.Wg)(u.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0}function z(u,n,t){var l,a,o;if(!t||0===t.glyphMosaicItems.length)return u;const L=(0,W.E)(n.text)[1],g=(0,w.Nr)(t.glyphMosaicItems,L,{scale:(0,K.F2)(n.font.size)/$.Ex,angle:null!=(l=n.angle)?l:0,xOffset:null!=(a=n.xoffset)?a:0,yOffset:null!=(o=n.yoffset)?o:0,hAlign:(0,J.kH)(n.horizontalAlignment||"center"),vAlign:(0,J.b7)(n.verticalAlignment||"baseline"),maxLineWidth:Math.max(32,Math.min(n.lineWidth||512,512)),lineHeight:$.xm*Math.max(.25,Math.min(n.lineHeight||1,4)),decoration:n.font.decoration||"none",isCIM:!1}).bounds;return u[0]=(0,K.F2)(g.x-g.halfWidth),u[1]=(0,K.F2)(g.y-g.halfHeight),u[2]=(0,K.F2)(g.width),u[3]=(0,K.F2)(g.height),u}function s(u){if(!u)return null;const{xmin:n,ymin:t,xmax:l,ymax:a,spatialReference:o}=u;return new Z.Z({rings:[[[n,t],[n,a],[l,a],[l,t],[n,t]]],spatialReference:o})}},62192:(Y,j,f)=>{f.d(j,{aV:()=>a,S1:()=>n,os:()=>t,yR:()=>o});var E,W=f(26584),N=f(8314),K=f(63290),Z=f(62208),X=f(50011),H=f(68598),J=f(64902),$=f(17626),w=f(58817),U=f(77712),T=(f(90912),f(76898)),F=f(99433),y=f(86971);let z=E=class extends H.Z{writeLevels(d,b,v){for(const S in d)return void(b.stops=this.levels[S])}clone(){return new E({axis:this.axis,field:this.field,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle,maxDataValue:this.maxDataValue,maxSize:(0,y.iY)(this.maxSize)?this.maxSize.clone():this.maxSize,minDataValue:this.minDataValue,minSize:(0,y.iY)(this.minSize)?this.minSize.clone():this.minSize,normalizationField:this.normalizationField,stops:this.stops&&this.stops.map(d=>d.clone()),target:this.target,useSymbolValue:this.useSymbolValue,valueRepresentation:this.valueRepresentation,valueUnit:this.valueUnit,legendOptions:this.legendOptions&&this.legendOptions.clone(),levels:(0,w.d9)(this.levels)})}};(0,$._)([(0,U.Cb)()],z.prototype,"levels",void 0),(0,$._)([(0,F.c)("levels")],z.prototype,"writeLevels",null),z=E=(0,$._)([(0,T.j)("esri.views.2d.engine.LevelDependentSizeVariable")],z);const s=K.Z.getLogger("esri.views.2d.layers.support.clusterUtils");N.Z.add("esri-cluster-arcade-enabled",!0);const u=(0,N.Z)("esri-cluster-arcade-enabled"),n=(d,b,v,S)=>{const h=b.clone();if(!o(h))return h;if(v.fields)for(const M of v.fields)p(d,M);if("visualVariables"in h){const M=(h.visualVariables||[]).filter(D=>"$view.scale"!==D.valueExpression),ee=t(M);M.forEach(D=>{"rotation"===D.type?D.field?D.field=O(d,D.field,"avg_angle"):D.valueExpression&&(D.field=g(d,D.valueExpression,"avg_angle"),D.valueExpression=null):D.normalizationField?(D.field=O(d,D.field,"norm",D.normalizationField),D.normalizationField=null):D.field?D.field=O(d,D.field,"avg"):(D.field=g(d,D.valueExpression,"avg"),D.valueExpression=null)}),(0,Z.Wi)(ee)&&!l(M)&&(M.push(a(v,S)),h.dynamicClusterSize=!0),h.visualVariables=M}switch(h.type){case"simple":break;case"unique-value":h.field?h.field=O(d,h.field,"mode"):h.valueExpression&&(h.field=g(d,h.valueExpression,"mode"),h.valueExpression=null);break;case"class-breaks":h.normalizationField?(h.field=O(d,h.field,"norm",h.normalizationField),h.normalizationField=null):h.field?h.field=O(d,h.field,"avg"):(h.field=g(d,h.valueExpression,"avg"),h.valueExpression=null)}return h},t=d=>{for(const b of d)if("size"===b.type)return b;return null},l=d=>{for(const b of d)if("cluster_count"===b.field)return!0;return!1},a=(d,b)=>{const v=[new J.Z({value:0,size:0}),new J.Z({value:1})];if((0,Z.Wi)(b))return new H.Z({field:"cluster_count",stops:[...v,new J.Z({value:2,size:0})]});const S=Object.keys(b).reduce((h,M)=>G(A({},h),{[M]:[...v,new J.Z({value:Math.max(2,b[M].minValue),size:d.clusterMinSize}),new J.Z({value:Math.max(3,b[M].maxValue),size:d.clusterMaxSize})]}),{});return new z({field:"cluster_count",levels:S})},o=d=>{const b=v=>s.error(new W.Z("Unsupported-renderer",v,{renderer:d}));if("unique-value"===d.type){if(d.field2||d.field3)return b("FeatureReductionCluster does not support multi-field UniqueValueRenderers"),!1}else if("class-breaks"===d.type){if(d.normalizationField){const v=d.normalizationType;if("field"!==v)return b(`FeatureReductionCluster does not support a normalizationType of ${v}`),!1}}else if("simple"!==d.type)return b(`FeatureReductionCluster does not support renderers of type ${d.type}`),!1;if(!u){if("valueExpression"in d&&d.valueExpression)return b("FeatureReductionCluster does not currently support renderer.valueExpression. Support will be added in a future release"),!1;if(("visualVariables"in d&&d.visualVariables||[]).some(v=>!(!("valueExpression"in v)||!v.valueExpression)))return b("FeatureReductionCluster does not currently support visualVariables with a valueExpression. Support will be added in a future release"),!1}return!0};function p(d,b){const{name:v,outStatistic:S}=b,{onStatisticField:h,onStatisticValueExpression:M,statisticType:ee}=S;if(M){const D=(0,X.F)(M.toLowerCase());d.push({name:v,outStatistic:{onStatisticField:D,onStatisticValueExpression:M,statisticType:ee}})}else h?d.push({name:v,outStatistic:{onStatisticField:h,statisticType:ee}}):s.error(new W.Z("mapview-unsupported-field","Unable to handle field",{field:b}))}function g(d,b,v){const S=(0,X.F)(b),h="mode"===v?`cluster_type_${S}`:`cluster_avg_${S}`;return d.some(M=>M.name===h)||d.push({name:h,outStatistic:{onStatisticField:S,onStatisticValueExpression:b,statisticType:v}}),h}function O(d,b,v,S){if("cluster_count"===b||d.some(M=>M.name===b))return b;const h=function L(d,b,v){switch(d){case"avg":case"avg_angle":return`cluster_avg_${b}`;case"mode":return`cluster_type_${b}`;case"norm":{const S=v,h="field",M=b.toLowerCase()+",norm:"+h+","+S.toLowerCase();return"cluster_avg_"+(0,X.F)(M)}}}(v,b,S);return d.some(M=>M.name===h)||d.push("norm"===v?{name:h,outStatistic:{onStatisticField:b,onStatisticNormalizationField:S,statisticType:v}}:{name:h,outStatistic:{onStatisticField:b,statisticType:v}}),h}},43930:(Y,j,f)=>{f.d(j,{JV:()=>X,oq:()=>K});const N=new(f(2076).Xn)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function K(H){return N.toJSON(H)}function X(H){const{bandCount:J,attributeTable:$,colormap:w,pixelType:U}=H.rasterInfo;return 1===J&&(null!=$||null!=w||"u8"===U||"s8"===U)}}}]);